{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard{% endblock %}

{% block styles %}
<style>
    .admin-stats-card {
        transition: transform 0.2s;
    }
    .admin-stats-card:hover {
        transform: translateY(-2px);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% block admin_content %}
    {% endblock %}
</div>
{% endblock %}

{% block javascripts %}
<script>
// Admin currency converter functionality
function initAdminCurrencyConverter() {
    // Get currency selector
    const currencySelector = document.getElementById('adminCurrencySelector');
    if (!currencySelector) return;

    // Load saved currency
    const savedCurrency = localStorage.getItem('adminCurrency') || 'USD';
    currencySelector.value = savedCurrency;

    // Add change event listener
    currencySelector.addEventListener('change', function() {
        const newCurrency = this.value;
        localStorage.setItem('adminCurrency', newCurrency);
        updateAdminCurrencyDisplays(newCurrency);
    });

    // Initial update
    updateAdminCurrencyDisplays(savedCurrency);
}

function updateAdminCurrencyDisplays(targetCurrency) {
    // Update all price displays in admin interface
    const priceElements = document.querySelectorAll('[data-usd-price]');
    
    priceElements.forEach(element => {
        const usdPrice = parseFloat(element.dataset.usdPrice);
        if (!isNaN(usdPrice)) {
            const convertedPrice = convertAdminPrice(usdPrice, targetCurrency);
            element.textContent = formatAdminPrice(convertedPrice.amount, convertedPrice.currency);
            element.title = `${usdPrice} USD = ${convertedPrice.formatted}`;
        }
    });
}

function convertAdminPrice(amount, fromCurrency = 'USD', toCurrency = 'EUR') {
    // Exchange rates (would be fetched from API in production)
    const exchangeRates = {
        'EUR': 0.85,
        'GBP': 0.73,
        'JPY': 110.0,
        'CAD': 1.25,
        'AUD': 1.35,
        'CHF': 0.92,
        'CNY': 6.45,
        'INR': 74.0
    };

    if (fromCurrency === toCurrency) {
        return {
            amount: amount,
            currency: toCurrency,
            formatted: formatAdminPrice(amount, toCurrency)
        };
    }

    const rate = exchangeRates[toCurrency] || 1;
    const convertedAmount = amount * rate;

    return {
        amount: convertedAmount,
        currency: toCurrency,
        formatted: formatAdminPrice(convertedAmount, toCurrency)
    };
}

function formatAdminPrice(amount, currency) {
    const symbols = {
        'USD': '$',
        'EUR': '€',
        'GBP': '£',
        'JPY': '¥',
        'CAD': 'C$',
        'AUD': 'A$',
        'CHF': 'CHF',
        'CNY': '¥',
        'INR': '₹'
    };

    const symbol = symbols[currency] || currency;
    
    switch (currency) {
        case 'EUR':
            return symbol + amount.toFixed(2).replace('.', ',');
        case 'JPY':
        case 'CNY':
            return symbol + Math.round(amount).toString();
        default:
            return symbol + amount.toFixed(2);
    }
}

// Fetch real exchange rates for admin
async function fetchAdminExchangeRates() {
    try {
        const response = await fetch('https://api.exchangerate.host/latest?access_key=ce959b41ed1e15ff5f57064926e5d1d1');
        const data = await response.json();
        
        if (data.rates) {
            console.log('Admin exchange rates loaded successfully');
            // Update displays with real rates
            updateAdminCurrencyDisplays(localStorage.getItem('adminCurrency') || 'USD');
        }
        
    } catch (error) {
        console.log('Using fallback exchange rates for admin');
        console.log('API Error:', error);
    }
}
</script>
{% endblock %}
