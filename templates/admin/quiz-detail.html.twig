{% extends 'admin/base_admin.html.twig' %}

{% block title %}Quiz Details - Admin Dashboard{% endblock %}

{% block admin_content %}

		<!-- Title -->
		<div class="row">
			<div class="col-12 mb-3">
				<div class="d-sm-flex justify-content-between align-items-center">
					<div>
						<h1 class="h3 mb-2">{{ quiz.title }}</h1>
						<p class="mb-0">View quiz details and questions.</p>
					</div>
					<div class="d-flex gap-2">
						<a href="{{ path('app_admin_quizzes') }}" class="btn btn-secondary-soft">
							<i class="bi bi-arrow-left me-2"></i>Back to Quizzes
						</a>
						<a href="{{ path('app_admin_quiz_edit', {'id': quiz.id}) }}" class="btn btn-primary">
							<i class="bi bi-pencil me-2"></i>Edit Quiz
						</a>
					</div>
				</div>
			</div>
		</div>

		<!-- Quiz Details START -->
		<div class="row g-4 mb-4">
			<!-- Quiz Info Card -->
			<div class="col-lg-6">
				<div class="card shadow h-100">
					<div class="card-header bg-primary text-white">
						<h5 class="card-header-title mb-0">
							<i class="bi bi-info-circle me-2"></i>Quiz Information
						</h5>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<div class="col-12">
								<label class="form-label">Quiz Title</label>
								<input type="text" class="form-control" value="{{ quiz.title }}" readonly>
							</div>
							<div class="col-md-6">
								<label class="form-label">Total Questions</label>
								<input type="text" class="form-control" value="{{ questions|length }}" readonly>
							</div>
							<div class="col-md-6">
								<label class="form-label">Created Date</label>
								<input type="text" class="form-control" value="{{ quiz.createdAt ? quiz.createdAt|date('Y-m-d H:i:s') : 'N/A' }}" readonly>
							</div>
							<div class="col-md-6">
								<label class="form-label">Last Updated</label>
								<input type="text" class="form-control" value="{{ quiz.updatedAt ? quiz.updatedAt|date('Y-m-d H:i:s') : 'Never' }}" readonly>
							</div>
							<div class="col-md-6">
								<label class="form-label">Status</label>
								<input type="text" class="form-control" value="Active" readonly>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Statistics Card -->
			<div class="col-lg-6">
				<div class="card shadow h-100">
					<div class="card-header bg-success text-white">
						<h5 class="card-header-title mb-0">
							<i class="bi bi-bar-chart me-2"></i>Quick Statistics
						</h5>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<div class="col-6">
								<div class="text-center p-3 bg-primary bg-opacity-10 rounded">
									<h3 class="mb-1 text-primary">{{ questions|length }}</h3>
									<p class="mb-0 small">Total Questions</p>
								</div>
							</div>
							<div class="col-6">
								<div class="text-center p-3 bg-success bg-opacity-10 rounded">
									<h3 class="mb-1 text-success">
										{% set multipleChoice = 0 %}
										{% for question in questions %}
											{% if question.optionA and question.optionB %}
												{% set multipleChoice = multipleChoice + 1 %}
											{% endif %}
										{% endfor %}
										{{ multipleChoice }}
									</h3>
									<p class="mb-0 small">Multiple Choice</p>
								</div>
							</div>
							<div class="col-6">
								<div class="text-center p-3 bg-warning bg-opacity-10 rounded">
									<h3 class="mb-1 text-warning">
										{% set trueFalse = 0 %}
										{% for question in questions %}
											{% if question.optionA == 'True' or question.optionB == 'False' %}
												{% set trueFalse = trueFalse + 1 %}
											{% endif %}
										{% endfor %}
										{{ trueFalse }}
									</h3>
									<p class="mb-0 small">True/False</p>
								</div>
							</div>
							<div class="col-6">
								<div class="text-center p-3 bg-info bg-opacity-10 rounded">
									<h3 class="mb-1 text-info">100%</h3>
									<p class="mb-0 small">Completion Rate</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Quiz Details END -->

		<!-- Questions List START -->
		<div class="card shadow">
			<div class="card-header d-flex justify-content-between align-items-center">
				<h5 class="card-header-title mb-0">
					<i class="bi bi-question-circle me-2"></i>Questions ({{ questions|length }})
				</h5>
				<div class="d-flex gap-2">
					<button class="btn btn-sm btn-success-soft" onclick="printQuestions()">
						<i class="bi bi-printer me-1"></i>Print
					</button>
					<button class="btn btn-sm btn-primary-soft" onclick="exportQuestions()">
						<i class="bi bi-download me-1"></i>Export
					</button>
				</div>
			</div>
			<div class="card-body">
				{% if questions|length > 0 %}
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>#</th>
									<th>Question</th>
									<th>Option A</th>
									<th>Option B</th>
									<th>Option C</th>
									<th>Option D</th>
									<th>Correct Answer</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for question in questions %}
								<tr>
									<td>{{ loop.index }}</td>
									<td>{{ question.question }}</td>
									<td>{{ question.optionA }}</td>
									<td>{{ question.optionB }}</td>
									<td>{{ question.optionC }}</td>
									<td>{{ question.optionD }}</td>
									<td>
										<span class="badge bg-success">{{ question.correctOption }}</span>
									</td>
									<td>
										<div class="dropdown">
											<button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
												<i class="bi bi-three-dots"></i>
											</button>
											<ul class="dropdown-menu">
												<li>
													<a class="dropdown-item" href="#" onclick="viewQuestion({{ question.id }})">
														<i class="bi bi-eye me-2"></i>View
													</a>
												</li>
												<li>
													<a class="dropdown-item" href="#" onclick="editQuestion({{ question.id }})">
														<i class="bi bi-pencil me-2"></i>Edit
													</a>
												</li>
												<li>
													<a class="dropdown-item text-danger" href="#" onclick="deleteQuestion({{ question.id }}, '{{ question.question|e('js') }}')">
														<i class="bi bi-trash me-2"></i>Delete
													</a>
												</li>
											</ul>
										</div>
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% else %}
					<div class="text-center py-5">
						<i class="bi bi-question-circle fs-1 text-muted mb-3"></i>
						<h4 class="text-muted">No Questions Found</h4>
						<p class="text-muted">This quiz doesn't have any questions yet.</p>
						<a href="{{ path('app_admin_quiz_edit', {'id': quiz.id}) }}" class="btn btn-primary">
							<i class="bi bi-plus-circle me-2"></i>Add First Question
						</a>
					</div>
				{% endif %}
			</div>
		</div>
		<!-- Questions List END -->

	</div>
	<!-- Page main content END -->
{% endblock %}

{% block admin_scripts %}
<script>
function printQuestions() {
	window.print();
}

function exportQuestions() {
	const quizData = {
		title: '{{ quiz.title|e('js') }}',
		questions: [
			{% for question in questions %}
			{
				id: {{ question.id }},
				question: '{{ question.question|e('js') }}',
				optionA: '{{ question.optionA|e('js') }}',
				optionB: '{{ question.optionB|e('js') }}',
				optionC: '{{ question.optionC|e('js') }}',
				optionD: '{{ question.optionD|e('js') }}',
				correctOption: '{{ question.correctOption|e('js') }}'
			}{% if not loop.last %},{% endif %}
			{% endfor %}
		]
	};
	
	const dataStr = JSON.stringify(quizData, null, 2);
	const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
	
	const exportFileDefaultName = 'quiz_{{ quiz.id }}_questions.json';
	
	const linkElement = document.createElement('a');
	linkElement.setAttribute('href', dataUri);
	linkElement.setAttribute('download', exportFileDefaultName);
	linkElement.click();
}

function viewQuestion(questionId) {
	// Placeholder for view question functionality
	alert('View question ID: ' + questionId + '\nThis feature is coming soon!');
}

function editQuestion(questionId) {
	// Placeholder for edit question functionality  
	alert('Edit question ID: ' + questionId + '\nThis feature is coming soon!');
}

function deleteQuestion(questionId, questionText) {
	if (confirm('Are you sure you want to delete this question?\n\n"' + questionText + '"')) {
		// Placeholder for delete question functionality
		alert('Delete question ID: ' + questionId + '\nThis feature is coming soon!');
	}
}
</script>
{% endblock %}
