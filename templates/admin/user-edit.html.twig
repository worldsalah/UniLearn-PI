{% extends 'admin/base_admin.html.twig' %}

{% block title %}Edit User - {{ user.fullName }} - Admin{% endblock %}

{% block admin_content %}

	<!-- Title -->
	<div class="row">
		<div class="col-12 mb-3">
			<div class="d-flex justify-content-between align-items-center">
				<h1 class="h3 mb-2 mb-sm-0">Edit User</h1>
				<a href="{{ path('admin_user_view', {'id': user.id}) }}" class="btn btn-secondary mb-0">
					<i class="bi bi-arrow-left me-2"></i>Back to User Details
				</a>
			</div>
		</div>
	</div>

	<!-- Edit Form -->
	<div class="row">
		<div class="col-lg-8">
			<div class="card shadow">
				<div class="card-header bg-light border-bottom">
					<h5 class="card-header-title mb-0">User Information</h5>
				</div>
				<div class="card-body">
					<form method="POST" action="{{ path('admin_user_edit', {'id': user.id}) }}">
						<input type="hidden" name="_token" value="{{ csrf_token('edit_user_' ~ user.id) }}">
						
						<div class="row g-3">
							<div class="col-md-6">
								<label for="fullName" class="form-label">Full Name</label>
								<input type="text" class="form-control" id="fullName" name="fullName" 
									   value="{{ user.fullName }}" required>
							</div>
							
							<div class="col-md-6">
								<label for="email" class="form-label">Email Address</label>
								<input type="email" class="form-control" id="email" name="email" 
									   value="{{ user.email }}" required>
							</div>
							
							<div class="col-md-6">
								<label for="role" class="form-label">Role</label>
								<select class="form-select" id="role" name="role" required>
									{% set userRole = user.role ? user.role.name : 'Student' %}
									<option value="Student" {% if userRole == 'Student' %}selected{% endif %}>Student</option>
									<option value="Instructor" {% if userRole == 'Instructor' %}selected{% endif %}>Instructor</option>
									<option value="Admin" {% if userRole == 'Admin' %}selected{% endif %}>Admin</option>
								</select>
							</div>
							
							<div class="col-md-6">
								<label for="status" class="form-label">Status</label>
								<select class="form-select" id="status" name="status" required>
									<option value="active" {% if user.status == 'active' %}selected{% endif %}>Active</option>
									<option value="inactive" {% if user.status == 'inactive' %}selected{% endif %}>Inactive</option>
									<option value="suspended" {% if user.status == 'suspended' %}selected{% endif %}>Suspended</option>
								</select>
							</div>
							
							<div class="col-md-6">
								<label for="phone" class="form-label">Phone</label>
								<input type="tel" class="form-control" id="phone" name="phone" 
									   value="{{ user.phone }}" placeholder="Optional">
							</div>
							
							<div class="col-md-6">
								<label for="location" class="form-label">Location</label>
								<input type="text" class="form-control" id="location" name="location" 
									   value="{{ user.location }}" placeholder="Optional">
							</div>
							
							<div class="col-12">
								<label for="bio" class="form-label">Bio</label>
								<textarea class="form-control" id="bio" name="bio" rows="4" 
										  placeholder="Optional">{{ user.bio }}</textarea>
							</div>
							
							<div class="col-12">
								<div class="d-flex justify-content-between">
									<a href="{{ path('admin_user_view', {'id': user.id}) }}" class="btn btn-secondary">
										Cancel
									</a>
									<button type="submit" class="btn btn-primary">
										<i class="bi bi-check-circle me-2"></i>Save Changes
									</button>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		
		<!-- User Preview -->
		<div class="col-lg-4">
			<div class="card shadow">
				<div class="card-header bg-light border-bottom">
					<h5 class="card-header-title mb-0">Current Profile</h5>
				</div>
				<div class="card-body text-center">
					<!-- Avatar -->
					<div class="avatar avatar-xl mb-3">
						<img class="avatar-img rounded-circle" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="avatar">
					</div>
					
					<h4 class="mb-2">{{ user.fullName }}</h4>
					<p class="text-muted mb-3">{{ user.email }}</p>
					
					<!-- Role Badge -->
					<div class="mb-2">
						{% set userRole = user.role ? user.role.name : 'User' %}
						{% if userRole == 'Student' %}
							<span class="badge bg-primary">{{ userRole }}</span>
						{% elseif userRole == 'Instructor' %}
							<span class="badge bg-success">{{ userRole }}</span>
						{% elseif userRole == 'Admin' %}
							<span class="badge bg-danger">{{ userRole }}</span>
						{% else %}
							<span class="badge bg-secondary">{{ userRole }}</span>
						{% endif %}
					</div>
					
					<!-- Status Badge -->
					<div class="mb-3">
						{% if user.status == 'active' %}
							<span class="badge bg-success bg-opacity-10 text-success">Active</span>
						{% elseif user.status == 'inactive' %}
							<span class="badge bg-warning bg-opacity-15 text-warning">Inactive</span>
						{% else %}
							<span class="badge bg-danger bg-opacity-10 text-danger">{{ user.status|capitalize }}</span>
						{% endif %}
					</div>
					
					<div class="text-start">
						<small class="text-muted">
							<div><strong>Member Since:</strong> {{ user.createdAt ? user.createdAt|date('F j, Y') : 'N/A' }}</div>
							{% if user.phone %}<div><strong>Phone:</strong> {{ user.phone }}</div>{% endif %}
							{% if user.location %}<div><strong>Location:</strong> {{ user.location }}</div>{% endif %}
						</small>
					</div>
				</div>
			</div>
			
			<!-- Quick Actions -->
			<div class="card shadow mt-4">
				<div class="card-header bg-light border-bottom">
					<h5 class="card-header-title mb-0">Quick Actions</h5>
				</div>
				<div class="card-body">
					<div class="d-grid gap-2">
						<!-- Status Toggle Button -->
						<form method="POST" action="{{ path('admin_user_' ~ (user.status == 'active' ? 'suspend' : 'activate'), {'id': user.id}) }}" 
							  onsubmit="return confirm('Are you sure you want to {{ user.status == 'active' ? 'suspend' : 'activate' }} this user?')">
							<input type="hidden" name="_token" value="{{ csrf_token('user_status_' ~ user.id) }}">
							<button type="submit" class="btn {% if user.status == 'active' %}btn-warning{% else %}btn-success{% endif %} w-100">
								<i class="bi bi-{% if user.status == 'active' %}pause{% else %}play{% endif %} me-2"></i>
								{{ user.status == 'active' ? 'Suspend' : 'Activate' }}
							</button>
						</form>
						
						<!-- Delete Button -->
						<form method="POST" action="{{ path('admin_user_delete', {'id': user.id}) }}" 
							  onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone and will remove all associated data.')">
							<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
							<button type="submit" class="btn btn-danger w-100">
								<i class="bi bi-trash me-2"></i>Delete User
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

{% endblock %}

{% block admin_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add form validation
    const form = document.querySelector('form[method="POST"]');
    if (form) {
        form.addEventListener('submit', function(e) {
            const email = document.getElementById('email').value;
            const fullName = document.getElementById('fullName').value;
			
            // Basic validation
            if (!fullName.trim()) {
                e.preventDefault();
                alert('Please enter a full name');
                return;
			}
			
			if (!email.trim()) {
				e.preventDefault();
				alert('Please enter an email address');
				return;
			}
			
			// Email validation
			const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			if (!emailRegex.test(email)) {
				e.preventDefault();
				alert('Please enter a valid email address');
				return;
			}
		});
	}
});
</script>
{% endblock %}
