{% extends 'admin/base_admin.html.twig' %}

{% block title %}User Details - {{ user.fullName }} - Admin{% endblock %}

{% block admin_content %}

	<!-- Flash Messages -->
	{% for type, messages in app.session.flashbag.all() %}
		{% for message in messages %}
			<div class="alert alert-{{ type == 'error' ? 'danger' : type }} alert-dismissible fade show" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		{% endfor %}
	{% endfor %}

	<!-- Title -->
	<div class="row">
		<div class="col-12 mb-3">
			<div class="d-flex justify-content-between align-items-center">
				<h1 class="h3 mb-2 mb-sm-0">User Details</h1>
				<a href="{{ path('admin_student_list') }}" class="btn btn-secondary mb-0">
					<i class="bi bi-arrow-left me-2"></i>Back to Students
				</a>
			</div>
		</div>
	</div>

	<!-- User Profile Card -->
	<div class="row g-4 mb-4">
		<!-- Profile Card -->
		<div class="col-lg-4">
			<div class="card shadow h-100">
				<div class="card-body text-center p-4">
					<!-- Avatar -->
					<div class="avatar avatar-xl mb-3">
						<img class="avatar-img rounded-circle" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="avatar">
					</div>
					
					<h4 class="mb-2">{{ user.fullName }}</h4>
					<p class="text-muted mb-3">{{ user.email }}</p>
					
					<!-- Role Badge -->
					<div class="mb-2">
						{% set userRole = user.role ? user.role.name : 'User' %}
						{% if userRole == 'Student' %}
							<span class="badge bg-primary">{{ userRole }}</span>
						{% elseif userRole == 'Instructor' %}
							<span class="badge bg-success">{{ userRole }}</span>
						{% elseif userRole == 'Admin' %}
							<span class="badge bg-danger">{{ userRole }}</span>
						{% else %}
							<span class="badge bg-secondary">{{ userRole }}</span>
						{% endif %}
					</div>
					
					<!-- Status Badge -->
					<div class="mb-3">
						{% if user.status == 'active' %}
							<span class="badge bg-success bg-opacity-10 text-success">Active</span>
						{% elseif user.status == 'inactive' %}
							<span class="badge bg-warning bg-opacity-15 text-warning">Inactive</span>
						{% else %}
							<span class="badge bg-danger bg-opacity-10 text-danger">{{ user.status|capitalize }}</span>
						{% endif %}
					</div>
					
					<!-- Action Buttons -->
					<div class="d-grid gap-2">
						<a href="{{ path('admin_user_edit', {'id': user.id}) }}" class="btn btn-primary">
							<i class="bi bi-pencil me-2"></i>Edit User
						</a>
						
						<!-- Status Toggle Button -->
						<form method="POST" action="{{ path('admin_user_' ~ (user.status == 'active' ? 'suspend' : 'activate'), {'id': user.id}) }}" 
							  onsubmit="return confirm('Are you sure you want to {{ user.status == 'active' ? 'suspend' : 'activate' }} this user?')">
							<input type="hidden" name="_token" value="{{ csrf_token('user_status_' ~ user.id) }}">
							<button type="submit" class="btn {% if user.status == 'active' %}btn-warning{% else %}btn-success{% endif %}">
								<i class="bi bi-{% if user.status == 'active' %}pause{% else %}play{% endif %} me-2"></i>
								{{ user.status == 'active' ? 'Suspend' : 'Activate' }}
							</button>
						</form>
						
						<!-- Delete Button -->
						<form method="POST" action="{{ path('admin_user_delete', {'id': user.id}) }}" 
							  onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone and will remove all associated data.')">
							<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
							<button type="submit" class="btn btn-danger">
								<i class="bi bi-trash me-2"></i>Delete User
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		
		<!-- User Details -->
		<div class="col-lg-8">
			<!-- Statistics Cards -->
			<div class="row g-4 mb-4">
				<div class="col-md-4">
					<div class="card card-body bg-primary bg-opacity-10 p-4 h-100">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<h2 class="mb-0 fw-bold">{{ user.courses|length }}</h2>
								<span class="mb-0 h6 fw-light">Courses</span>
							</div>
							<div class="icon-lg rounded-circle bg-primary text-white mb-0">
								<i class="fas fa-book fa-fw"></i>
							</div>
						</div>
					</div>
				</div>
				
				<div class="col-md-4">
					<div class="card card-body bg-success bg-opacity-10 p-4 h-100">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<h2 class="mb-0 fw-bold">{{ user.quizResults|length }}</h2>
								<span class="mb-0 h6 fw-light">Quiz Results</span>
							</div>
							<div class="icon-lg rounded-circle bg-success text-white mb-0">
								<i class="fas fa-question-circle fa-fw"></i>
							</div>
						</div>
					</div>
				</div>
				
				<div class="col-md-4">
					<div class="card card-body bg-warning bg-opacity-15 p-4 h-100">
						<div class="d-flex justify-content-between align-items-center">
							<div>
								<h2 class="mb-0 fw-bold">{{ user.createdAt ? user.createdAt|date('Y') : 'N/A' }}</h2>
								<span class="mb-0 h6 fw-light">Member Since</span>
							</div>
							<div class="icon-lg rounded-circle bg-warning text-white mb-0">
								<i class="fas fa-calendar fa-fw"></i>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- User Information -->
			<div class="card shadow">
				<div class="card-header bg-light border-bottom">
					<h5 class="card-header-title mb-0">User Information</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label fw-bold">Full Name</label>
								<p class="form-control-plaintext">{{ user.fullName }}</p>
							</div>
							
							<div class="mb-3">
								<label class="form-label fw-bold">Email Address</label>
								<p class="form-control-plaintext">{{ user.email }}</p>
							</div>
							
							<div class="mb-3">
								<label class="form-label fw-bold">Role</label>
								<p class="form-control-plaintext">
									{% set userRole = user.role ? user.role.name : 'User' %}
									{% if userRole == 'Student' %}
										<span class="badge bg-primary">{{ userRole }}</span>
									{% elseif userRole == 'Instructor' %}
										<span class="badge bg-success">{{ userRole }}</span>
									{% elseif userRole == 'Admin' %}
										<span class="badge bg-danger">{{ userRole }}</span>
									{% else %}
										<span class="badge bg-secondary">{{ userRole }}</span>
									{% endif %}
								</p>
							</div>
						</div>
						
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label fw-bold">Status</label>
								<p class="form-control-plaintext">
									{% if user.status == 'active' %}
										<span class="badge bg-success bg-opacity-10 text-success">Active</span>
									{% elseif user.status == 'inactive' %}
										<span class="badge bg-warning bg-opacity-15 text-warning">Inactive</span>
									{% else %}
										<span class="badge bg-danger bg-opacity-10 text-danger">{{ user.status|capitalize }}</span>
									{% endif %}
								</p>
							</div>
							
							<div class="mb-3">
								<label class="form-label fw-bold">Registration Date</label>
								<p class="form-control-plaintext">
									{% if user.createdAt %}
										{{ user.createdAt|date('F j, Y') }} at {{ user.createdAt|date('g:i A') }}
									{% else %}
										Not available
									{% endif %}
								</p>
							</div>
							
							<div class="mb-3">
								<label class="form-label fw-bold">Phone</label>
								<p class="form-control-plaintext">{{ user.phone ?: 'Not provided' }}</p>
							</div>
							
							<div class="mb-3">
								<label class="form-label fw-bold">Location</label>
								<p class="form-control-plaintext">{{ user.location ?: 'Not provided' }}</p>
							</div>
						</div>
					</div>
					
					{% if user.bio %}
					<div class="mt-3">
						<label class="form-label fw-bold">Bio</label>
						<p class="form-control-plaintext">{{ user.bio }}</p>
					</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>

{% endblock %}

{% block admin_scripts %}
<script>
// Add any JavaScript functionality if needed
document.addEventListener('DOMContentLoaded', function() {
    // Add confirmation for delete button
    const deleteForm = document.querySelector('form[action*="delete"]');
    if (deleteForm) {
        deleteForm.addEventListener('submit', function(e) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone and will remove all associated data.')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}
