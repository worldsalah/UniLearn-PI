{% extends 'base.html.twig' %}

{% block title %}Create Course - Eduport{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ asset('assets/vendor/choices/css/choices.min.css') }}">
<link rel="stylesheet" type="text/css" href="{{ asset('assets/vendor/aos/aos.css') }}">
<link rel="stylesheet" type="text/css" href="{{ asset('assets/vendor/glightbox/css/glightbox.css') }}">
<link rel="stylesheet" type="text/css" href="{{ asset('assets/vendor/quill/css/quill.snow.css') }}">
<link rel="stylesheet" type="text/css" href="{{ asset('assets/vendor/stepper/css/bs-stepper.min.css') }}">

<!-- Disable global Choices initialization for this page -->
<script>
// Prevent the global functions.js from initializing Choices on this page
window.choiceSkipInit = true;

// Override the choicesSelect function immediately to prevent any initialization
if (window.e && window.e.choicesSelect) {
    const originalChoicesSelect = window.e.choicesSelect;
    window.e.choicesSelect = function() {
        return; // Do nothing on course creation page
    };
}

// Also override the stepper function to prevent conflicts
if (window.e && window.e.stepper) {
    const originalStepper = window.e.stepper;
    window.e.stepper = function() {
        return; // Do nothing on course creation page
    };
}

// Also override it again when DOM is ready (in case it gets reset)
document.addEventListener("DOMContentLoaded", function() {
    if (window.e && window.e.choicesSelect) {
        window.e.choicesSelect = function() {
            return; // Do nothing on course creation page
        };
    }
    
    if (window.e && window.e.stepper) {
        window.e.stepper = function() {
            return; // Do nothing on course creation page
        };
    }
});
</script>

<style>
/* Stepper content visibility control */
.bs-stepper-content {
    opacity: 1;
    height: auto;
    overflow: visible;
    position: relative;
}

/* Simple stepper styles */
.bs-stepper-pane {
    display: none;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
}

.bs-stepper-pane.active {
    display: block;
    opacity: 1;
    visibility: visible;
}

/* Force first step to be visible */
#step-1 {
    display: block;
    opacity: 1;
    visibility: visible;
}

/* Hide other steps */
#step-2, #step-3, #step-4 {
    display: none;
    opacity: 0;
    visibility: hidden;
}

/* Custom styles for form elements */
.js-choice {
    background-color: transparent !important;
    border: 1px solid #dee2e6 !important;
}

/* Border dashed for file upload */
.border-dashed {
    border: 2px dashed #dee2e6 !important;
    background-color: #f8f9fa;
}

.border-dashed:hover {
    border-color: #007bff !important;
    background-color: #f0f8ff;
}

/* Custom button styles */
.btn-primary-soft {
    background-color: rgba(13, 110, 253, 0.1) !important;
    color: #0d6efd !important;
    border-color: rgba(13, 110, 253, 0.2) !important;
}

.btn-success-soft {
    background-color: rgba(25, 135, 84, 0.1) !important;
    color: #198754 !important;
    border-color: rgba(25, 135, 84, 0.2) !important;
}

.btn-primary-soft:hover {
    background-color: rgba(13, 110, 253, 0.2) !important;
    color: #0a58ca !important;
}

.btn-success-soft:hover {
    background-color: rgba(25, 135, 84, 0.2) !important;
    color: #146c43 !important;
}

/* Chapter and lesson styling */
.chapter-item {
    transition: all 0.3s ease;
}

.chapter-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.lesson-item {
    background-color: #f8f9fa;
    padding: 8px;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.lesson-item:hover {
    background-color: #e9ecef;
}

/* Stepper customization */
.bs-stepper .step-trigger {
    color: #6c757d;
    text-decoration: none;
}

.bs-stepper .step.active .step-trigger {
    color: #007bff;
}

.bs-stepper .step.completed .step-trigger {
    color: #198754;
}

.bs-stepper-circle {
    background-color: #e9ecef;
    color: #6c757d;
    border: 2px solid #dee2e6;
}

.bs-stepper .step.active .bs-stepper-circle {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.bs-stepper .step.completed .bs-stepper-circle {
    background-color: #198754;
    color: white;
    border-color: #198754;
}

/* Form validation styles */
.form-control.is-invalid {
    border-color: #dc3545;
}

.form-control.is-valid {
    border-color: #198754;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .bs-stepper-header {
        flex-wrap: wrap;
    }
    
    .bs-stepper-header .step {
        flex: 1 1 50%;
        margin-bottom: 10px;
    }
    
    .bs-stepper-header .line {
        display: none;
    }
}
</style>
{% endblock %}

{% block body %}
<div class="course-creation-page">
<!-- Header START -->
<header class="navbar-light navbar-sticky">
	<!-- Logo Nav START -->
	<nav class="navbar navbar-expand-xl">
		<div class="container">
			<!-- Logo START -->
			<a class="navbar-brand" href="{{ path('app_home') }}">
				<img class="light-mode-item navbar-brand-item" src="{{ asset('assets/images/logo.svg') }}" alt="logo">
				<img class="dark-mode-item navbar-brand-item" src="{{ asset('assets/images/logo-light.svg') }}" alt="logo">
			</a>
			<!-- Logo END -->

			<!-- Responsive navbar toggler -->
			<button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-animation">
					<span></span>
					<span></span>
					<span></span>
				</span>
			</button>

			<!-- Main navbar START -->
			<div class="navbar-collapse w-100 collapse" id="navbarCollapse">
				<!-- Nav Main menu START -->
				<ul class="navbar-nav navbar-nav-scroll mx-auto">
					<!-- Nav item 1 Demos -->
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="demoMenu" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Demos</a>
						<ul class="dropdown-menu" aria-labelledby="demoMenu">
							<li> <a class="dropdown-item" href="{{ path('app_home') }}">Home Default</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_home_variant') }}">Home Education</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_home_variant_3') }}">Home Academy</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_course_grid') }}">Home Course</a></li>
						</ul>
					</li>

					<!-- Nav item 2 Pages -->
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="pagesMenu" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages</a>
						<ul class="dropdown-menu" aria-labelledby="pagesMenu">
							<li> <a class="dropdown-item" href="{{ path('app_about') }}">About Us</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_contact') }}">Contact Us</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_courses') }}">Courses</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_instructor_list') }}">Instructors</a></li>
						</ul>
					</li>

					<!-- Nav item 3 Account -->
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="accounntMenu" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Accounts</a>
						<ul class="dropdown-menu" aria-labelledby="accounntMenu">
							<li class="dropdown-submenu dropend">
								<a class="dropdown-item dropdown-toggle" href="#"><i class="fas fa-user-tie fa-fw me-1"></i>Instructor</a>
								<ul class="dropdown-menu dropdown-menu-start" data-bs-popper="none">
									<li> <a class="dropdown-item" href="{{ path('app_instructor_dashboard') }}"><i class="bi bi-grid-fill fa-fw me-1"></i>Dashboard</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_manage_courses') }}"><i class="bi bi-basket-fill fa-fw me-1"></i>Courses</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_course_create') }}"><i class="bi bi-file-earmark-plus-fill fa-fw me-1"></i>Create Course</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_quiz') }}"><i class="bi bi-question-diamond fa-fw me-1"></i>Quiz</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_earnings') }}"><i class="fas fa-chart-line fa-fw me-1"></i>Earnings</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_students') }}"><i class="fas fa-user-graduate fa-fw me-1"></i>Students</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_orders') }}"><i class="bi bi-cart-check-fill fa-fw me-1"></i>Orders</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_reviews') }}"><i class="bi bi-star-fill fa-fw me-1"></i>Reviews</a> </li>
									<li> <a class="dropdown-item" href="{{ path('app_instructor_payout') }}"><i class="fas fa-wallet fa-fw me-1"></i>Payout</a> </li>
								</ul>
							</li>
							<li> <a class="dropdown-item" href="#"><i class="fas fa-user-cog fa-fw me-1"></i>Admin</a> </li>
							<li> <hr class="dropdown-divider"></li>
							<li> <a class="dropdown-item" href="{{ path('app_instructor_edit_profile') }}"><i class="fas fa-fw fa-edit me-1"></i>Edit Profile</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_instructor_settings') }}"><i class="fas fa-fw fa-cog me-1"></i>Settings</a></li>
							<li> <a class="dropdown-item" href="{{ path('app_instructor_delete_account') }}"><i class="fas fa-fw fa-trash-alt me-1"></i>Delete Profile</a></li>
							<li> <hr class="dropdown-divider"></li>
							<li> <a class="dropdown-item bg-danger-soft-hover" href="{{ path('app_login') }}"><i class="bi bi-power fa-fw me-2"></i>Sign Out</a></li>
						</ul>
					</li>
				</ul>
				<!-- Nav Main menu END -->
			</div>
			<!-- Main navbar END -->

			<!-- Profile START -->
			<div class="dropdown ms-1 ms-lg-0">
				<a class="avatar avatar-sm p-0" href="#" id="profileDropdown" role="button" data-bs-auto-close="outside" data-bs-display="static" data-bs-toggle="dropdown" aria-expanded="false">
					<img class="avatar-img rounded-circle" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="avatar">
				</a>
				<ul class="dropdown-menu dropdown-animation dropdown-menu-end shadow pt-3" aria-labelledby="profileDropdown">
					<!-- Profile info -->
					<li class="px-3 mb-3">
						<div class="d-flex align-items-center">
							<!-- Avatar -->
							<div class="avatar me-3">
								<img class="avatar-img rounded-circle shadow" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="avatar">
							</div>
							<div>
								<a class="h6" href="#">Lori Ferguson</a>
								<p class="small m-0">example@gmail.com</p>
							</div>
						</div>
					</li>
					<li> <hr class="dropdown-divider"></li>
					<!-- Links -->
					<li><a class="dropdown-item" href="{{ path('app_instructor_edit_profile') }}"><i class="bi bi-person fa-fw me-2"></i>Edit Profile</a></li>
					<li><a class="dropdown-item" href="#"><i class="bi bi-gear fa-fw me-2"></i>Account Settings</a></li>
					<li><a class="dropdown-item" href="#"><i class="bi bi-info-circle fa-fw me-2"></i>Help</a></li>
					<li><a class="dropdown-item bg-danger-soft-hover" href="{{ path('app_login') }}"><i class="bi bi-power fa-fw me-2"></i>Sign Out</a></li>
				</ul>
			</div>
			<!-- Profile START -->
		</div>
	</nav>
	<!-- Logo Nav END -->
</header>
<!-- Header END -->

<!-- **************** MAIN CONTENT START **************** -->
<main>
	
<!-- =======================
Page Banner START -->
<section class="pt-0">
	<!-- Main banner background image -->
	<div class="container-fluid px-0">
		<div class="bg-blue h-100px h-md-200px rounded-0" style="background:url({{ asset('assets/images/pattern/04.png') }}) no-repeat center center; background-size:cover;">
		</div>
	</div>
	<div class="container mt-n4">
		<div class="row">
			<!-- Profile banner START -->
			<div class="col-12">
				<div class="card bg-transparent card-body p-0">
					<div class="row d-flex justify-content-between">
						<!-- Avatar -->
						<div class="col-auto mt-4 mt-md-0">
							<div class="avatar avatar-xxl mt-n3">
								<img class="avatar-img rounded-circle border border-white border-3 shadow" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="">
							</div>
						</div>
						<!-- Profile info -->
						<div class="col d-md-flex justify-content-between align-items-center mt-4">
							<div>
								<h1 class="my-1 fs-4">Lori Stevens <i class="bi bi-patch-check-fill text-info small"></i></h1>
								<ul class="list-inline mb-0">
									<li class="list-inline-item h6 fw-light me-3 mb-1 mb-sm-0"><i class="fas fa-star text-warning me-2"></i>4.5/5.0</li>
									<li class="list-inline-item h6 fw-light me-3 mb-1 mb-sm-0"><i class="fas fa-user-graduate text-orange me-2"></i>12k Enrolled Students</li>
									<li class="list-inline-item h6 fw-light me-3 mb-1 mb-sm-0"><i class="fas fa-book text-purple me-2"></i>25 Courses</li>
								</ul>
							</div>
							<!-- Button -->
							<div class="d-flex align-items-center mt-2 mt-md-0">
								<a href="#" class="btn btn-success mb-0">Create a course</a>
							</div>
						</div>
					</div>
				</div>
				<!-- Profile banner END -->

				<!-- Advanced filter responsive toggler START -->
				<!-- Divider -->
				<hr class="d-xl-none">
				<div class="col-12 col-xl-3 d-flex justify-content-between align-items-center">
					<a class="h6 mb-0 fw-bold d-xl-none" href="#">Menu</a>
					<button class="btn btn-primary d-xl-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
						<i class="fas fa-sliders-h"></i>
					</button>
				</div>
				<!-- Advanced filter responsive toggler END -->
			</div>
		</div>
	</div>
</section>
<!-- =======================
Page Banner END -->

<!-- =======================
Page content START -->
<section class="pt-0">
	<div class="container">
		<div class="row">
			<!-- Left sidebar START -->
			<div class="col-xl-3">
				<!-- Responsive offcanvas body START -->
				<div class="offcanvas-xl offcanvas-end" tabindex="-1" id="offcanvasSidebar">
					<!-- Offcanvas header -->
					<div class="offcanvas-header bg-light">
						<h5 class="offcanvas-title" id="offcanvasNavbarLabel">My profile</h5>
						<button  type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasSidebar" aria-label="Close"></button>
					</div>
					<!-- Offcanvas body -->
					<div class="offcanvas-body p-3 p-xl-0">
						<div class="bg-dark border rounded-3 pb-0 p-3 w-100">
							<!-- Dashboard menu -->
							<div class="list-group list-group-dark list-group-borderless">
								<a class="list-group-item" href="{{ path('app_instructor_dashboard') }}"><i class="bi bi-ui-checks-grid fa-fw me-2"></i>Dashboard</a>
								<a class="list-group-item" href="{{ path('app_instructor_manage_courses') }}"><i class="bi bi-basket fa-fw me-2"></i>My Courses</a>
								<a class="list-group-item" href="{{ path('app_course_create') }}"><i class="bi bi-file-earmark-plus-fill fa-fw me-2"></i>Create Course</a>
								<a class="list-group-item" href="{{ path('app_instructor_quiz') }}"><i class="bi bi-question-diamond fa-fw me-2"></i>Quiz</a>
								<a class="list-group-item" href="{{ path('app_instructor_earnings') }}"><i class="bi bi-graph-up fa-fw me-2"></i>Earnings</a>
								<a class="list-group-item" href="{{ path('app_instructor_students') }}"><i class="bi bi-people fa-fw me-2"></i>Students</a>
								<a class="list-group-item" href="{{ path('app_instructor_orders') }}"><i class="bi bi-folder-check fa-fw me-2"></i>Orders</a>
								<a class="list-group-item" href="{{ path('app_instructor_reviews') }}"><i class="bi bi-star fa-fw me-2"></i>Reviews</a>
								<a class="list-group-item" href="{{ path('app_instructor_edit_profile') }}"><i class="bi bi-pencil-square fa-fw me-2"></i>Edit Profile</a>
								<a class="list-group-item" href="{{ path('app_instructor_payout') }}"><i class="bi bi-wallet2 fa-fw me-2"></i>Payouts</a>
								<a class="list-group-item" href="{{ path('app_instructor_settings') }}"><i class="bi bi-gear fa-fw me-2"></i>Settings</a>
								<a class="list-group-item" href="{{ path('app_instructor_delete_account') }}"><i class="bi bi-trash fa-fw me-2"></i>Delete Profile</a>
								<a class="list-group-item text-danger bg-danger-soft-hover" href="{{ path('app_login') }}"><i class="fas fa-sign-out-alt fa-fw me-2"></i>Sign Out</a>
							</div>
						</div>
					</div>
				</div>
				<!-- Responsive offcanvas body END -->
			</div>
			<!-- Left sidebar END -->

			<!-- Main content START -->
			<div class="col-xl-9">
				<div class="card bg-transparent border">
					<div class="card-header bg-light border-bottom">
						<h5 class="mb-0">Create Course</h5>
					</div>
					<div class="card-body">
						<!-- =======================
						Steps START -->
						<div class="card bg-transparent border rounded-3">
							<div id="stepper" class="bs-stepper stepper-outline">
								<!-- Card header -->
								<div class="card-header bg-light border-bottom px-lg-5">
									<!-- Step Buttons START -->
									<div class="bs-stepper-header" role="tablist">
										<!-- Step 1 -->
										<div class="step" data-target="#step-1">
											<div class="d-grid text-center align-items-center">
												<button type="button" class="btn btn-link step-trigger mb-0" role="tab" id="steppertrigger1" aria-controls="step-1">
													<span class="bs-stepper-circle">1</span>
												</button>
												<h6 class="bs-stepper-label d-none d-md-block">Course details</h6>
											</div>
										</div>
										<div class="line"></div>

										<!-- Step 2 -->
										<div class="step" data-target="#step-2">
											<div class="d-grid text-center align-items-center">
												<button type="button" class="btn btn-link step-trigger mb-0" role="tab" id="steppertrigger2" aria-controls="step-2">
													<span class="bs-stepper-circle">2</span>
												</button>
												<h6 class="bs-stepper-label d-none d-md-block">Course media</h6>
											</div>
										</div>
										<div class="line"></div>

										<!-- Step 3 -->
										<div class="step" data-target="#step-3">
											<div class="d-grid text-center align-items-center">
												<button type="button" class="btn btn-link step-trigger mb-0" role="tab" id="steppertrigger3" aria-controls="step-3">
													<span class="bs-stepper-circle">3</span>
												</button>
												<h6 class="bs-stepper-label d-none d-md-block">Curriculum</h6>
											</div>
										</div>
										<div class="line"></div>

										<!-- Step 4 -->
										<div class="step" data-target="#step-4">
											<div class="d-grid text-center align-items-center">
												<button type="button" class="btn btn-link step-trigger mb-0" role="tab" id="steppertrigger4" aria-controls="step-4">
													<span class="bs-stepper-circle">4</span>
												</button>
												<h6 class="bs-stepper-label d-none d-md-block">Additional information</h6>
											</div>
										</div>
									</div>
									<!-- Step Buttons END -->
								</div>

								<!-- Card body START -->
								<div class="card-body">
									<!-- Step content START -->
									<div class="bs-stepper-content">
										<!-- Step 1 content START -->
										<div id="step-1" role="tabpanel" class="bs-stepper-pane content active fade" aria-labelledby="steppertrigger1">
											<form id="courseForm" onsubmit="return false">
												<!-- Title -->
												<h4>Course details</h4>

												<hr> <!-- Divider -->

												<!-- Basic information START -->
												<div class="row g-4">
													<!-- Course title -->
													<div class="col-12">
														<label class="form-label">Course title</label>
														<input class="form-control" type="text" placeholder="Enter course title" name="course_title">
													</div>

													<!-- Short description -->
													<div class="col-12">
														<label class="form-label">Short description</label>
														<textarea class="form-control" rows="2" placeholder="Enter keywords" name="short_description"></textarea>
													</div>

													<!-- Course category -->
													<div class="col-md-6">
														<label class="form-label">Course category</label>
														<select class="form-select js-choice" data-search-enabled="true" name="course_category">
															<option value="">Select category</option>
															<option>Engineer</option>
															<option>Medical</option>
															<option>Information technology</option>
															<option>Finance</option>
															<option>Marketing</option>
														</select>
													</div>

													<!-- Course level -->
													<div class="col-md-6">
														<label class="form-label">Course level</label>
														<select class="form-select js-choice" data-remove-item-button="true" name="course_level">
															<option value="">Select course level</option>
															<option>All level</option>
															<option>Beginner</option>
															<option>Intermediate</option>
															<option>Advance</option>
														</select>
													</div>

													<!-- Course price -->
													<div class="col-md-6">
														<label class="form-label">Course price</label>
														<input type="text" class="form-control" placeholder="Enter course price" name="course_price">
													</div>

													<!-- Course discount -->
													<div class="col-md-6">
														<label class="form-label">Discount price</label>
														<input class="form-control" type="text" placeholder="Enter discount" name="discount_price">
														<div class="col-12 mt-1 mb-0">
															<div class="form-check small mb-0">
																<input class="form-check-input" type="checkbox" id="checkBox1" name="enable_discount">
																<label class="form-check-label" for="checkBox1">
																	Enable this Discount
																</label>
															</div>
														</div>
													</div>
												</div>

												<!-- Navigation buttons START -->
												<div class="d-flex justify-content-end mt-4">
													<button type="button" class="btn btn-primary next-btn">Next</button>
												</div>
											</form>
										</div>
										<!-- Step 1 content END -->

										<!-- Step 2 content START -->
										<div id="step-2" role="tabpanel" class="bs-stepper-pane content fade" aria-labelledby="steppertrigger2">
											<form id="courseForm2" onsubmit="return false">
												<!-- Title -->
												<h4>Course media</h4>

												<hr> <!-- Divider -->

												<!-- Course image upload -->
												<div class="row g-4">
													<div class="col-12">
														<label class="form-label">Course thumbnail image</label>
														<div class="border-dashed rounded-2 p-4 text-center">
															<div class="mb-3">
																<img src="{{ asset('assets/images/gallery/01.jpg') }}" class="img-fluid rounded" alt="course thumbnail" style="max-height: 200px;">
															</div>
															<div>
																<label for="courseImage" class="btn btn-primary-soft mb-0">Choose image</label>
																<input type="file" id="courseImage" class="form-control d-none" accept="image/*">
																<p class="small mb-0 mt-2">PNG or JPG no bigger than 800px width and 200px height.</p>
															</div>
														</div>
													</div>

													<!-- Course video -->
													<div class="col-12">
														<label class="form-label">Course introduction video</label>
														<div class="border-dashed rounded-2 p-4 text-center">
															<div class="mb-3">
																<i class="fas fa-video fa-3x text-muted"></i>
															</div>
															<div>
																<label for="courseVideo" class="btn btn-success-soft mb-0">Upload video</label>
																<input type="file" id="courseVideo" class="form-control d-none" accept="video/*">
																<p class="small mb-0 mt-2">MP4, WebM or OGG (Max. 50MB)</p>
															</div>
														</div>
													</div>
												</div>

												<!-- Navigation buttons START -->
												<div class="d-flex justify-content-between mt-4">
													<button type="button" class="btn btn-secondary previous-btn">Previous</button>
													<button type="button" class="btn btn-primary next-btn">Next</button>
												</div>
											</form>
										</div>
										<!-- Step 2 content END -->

										<!-- Step 3 content START -->
										<div id="step-3" role="tabpanel" class="bs-stepper-pane content fade" aria-labelledby="steppertrigger3">
											<form id="courseForm3" onsubmit="return false">
												<!-- Title -->
												<h4>Curriculum</h4>

												<hr> <!-- Divider -->

												<!-- Course curriculum -->
												<div class="row g-4">
													<div class="col-12">
														<div class="d-flex justify-content-between align-items-center mb-3">
															<label class="form-label mb-0">Course chapters & lessons</label>
															<button type="button" class="btn btn-sm btn-primary" onclick="addChapter()">
																<i class="fas fa-plus"></i> Add Chapter
															</button>
														</div>

														<div id="chaptersContainer">
															<!-- Chapter 1 -->
															<div class="card mb-3 chapter-item">
																<div class="card-header bg-light">
																	<div class="d-flex justify-content-between align-items-center">
																		<input type="text" class="form-control form-control-sm" placeholder="Chapter 1: Introduction" style="max-width: 400px;">
																		<button type="button" class="btn btn-sm btn-danger" onclick="removeChapter(this)">
																			<i class="fas fa-trash"></i>
																		</button>
																	</div>
																</div>
																<div class="card-body">
																	<div class="mb-2">
																		<button type="button" class="btn btn-sm btn-outline-primary" onclick="addLesson(this)">
																			<i class="fas fa-plus"></i> Add Lesson
																		</button>
																	</div>
																	<div class="lessons-container">
																		<!-- Lesson 1 -->
																		<div class="d-flex align-items-center mb-2 lesson-item">
																			<i class="fas fa-play-circle me-2"></i>
																			<input type="text" class="form-control form-control-sm me-2" placeholder="Lesson title">
																			<input type="text" class="form-control form-control-sm me-2" placeholder="Duration (e.g., 15:30)">
																			<button type="button" class="btn btn-sm btn-danger" onclick="removeLesson(this)">
																				<i class="fas fa-times"></i>
																			</button>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>

												<!-- Navigation buttons START -->
												<div class="d-flex justify-content-between mt-4">
													<button type="button" class="btn btn-secondary previous-btn">Previous</button>
													<button type="button" class="btn btn-primary next-btn">Next</button>
												</div>
											</form>
										</div>
										<!-- Step 3 content END -->

										<!-- Step 4 content START -->
										<div id="step-4" role="tabpanel" class="bs-stepper-pane content fade" aria-labelledby="steppertrigger4">
											<form id="courseForm4" onsubmit="return false">
												<!-- Title -->
												<h4>Additional information</h4>

												<hr> <!-- Divider -->

												<!-- Additional information -->
												<div class="row g-4">
													<!-- Requirements -->
													<div class="col-12">
														<label class="form-label">Course requirements</label>
														<textarea class="form-control" rows="3" placeholder="What students should know before taking this course?" name="requirements"></textarea>
													</div>

													<!-- What students will learn -->
													<div class="col-12">
														<label class="form-label">What students will learn</label>
														<textarea class="form-control" rows="3" placeholder="What skills and knowledge will students gain?" name="learning_outcomes"></textarea>
													</div>

													<!-- Target audience -->
													<div class="col-12">
														<label class="form-label">Target audience</label>
														<textarea class="form-control" rows="3" placeholder="Who is this course for?" name="target_audience"></textarea>
													</div>

													<!-- Language -->
													<div class="col-md-6">
														<label class="form-label">Course language</label>
														<select class="form-select js-choice" name="language">
															<option value="">Select language</option>
															<option value="en">English</option>
															<option value="es">Spanish</option>
															<option value="fr">French</option>
															<option value="de">German</option>
															<option value="it">Italian</option>
															<option value="pt">Portuguese</option>
															<option value="zh">Chinese</option>
															<option value="ja">Japanese</option>
														</select>
													</div>

													<!-- Course duration -->
													<div class="col-md-6">
														<label class="form-label">Estimated duration (hours)</label>
														<input type="number" class="form-control" placeholder="e.g., 10" name="duration">
													</div>
												</div>

												<!-- Navigation buttons START -->
												<div class="d-flex justify-content-between mt-4">
													<button type="button" class="btn btn-secondary previous-btn">Previous</button>
													<button type="button" class="btn btn-success" onclick="submitCourse()">
														<i class="fas fa-check"></i> Submit Course
													</button>
												</div>
											</form>
										</div>
										<!-- Step 4 content END -->
									</div>
									<!-- Step content END -->
								</div>
								<!-- Card body END -->
							</div>
						</div>
						<!-- Steps END -->
					</div>
				</div>
			</div>
			<!-- Main content END -->
		</div>
	</div>
</section>
<!-- =======================
Page content END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->


<!-- Upload Progress Overlay -->
<div id="uploadOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
    <div class="card p-4" style="width: 450px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        <div class="mb-3">
            <div class="spinner-border text-primary" role="status" id="uploadSpinner" style="display: none;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <h5 id="uploadStatusTitle" class="mb-3">Uploading Course...</h5>
        <div class="progress mb-3" style="height: 25px;">
            <div id="uploadProgressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
        <p id="uploadStatusText" class="mb-0 text-muted">Please wait while we upload your files.</p>
        <p class="small text-danger mt-2" style="display: none;" id="uploadWarning">Do not close this window.</p>
    </div>
</div>

</div>
{% endblock %}

{% block javascripts %}
<!-- Init scripts for course creation page -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Initialize Choices.js with custom configuration (only on this page)
    const elements = document.querySelectorAll('.js-choice');
    
    elements.forEach(function(element) {
        // Only initialize if not already initialized by Choices
        if (!element.classList.contains('choices__input')) {
            new Choices(element, {
                searchEnabled: element.dataset.searchEnabled === 'true',
                searchPlaceholderValue: 'Search...',
                itemSelectText: 'Press to select',
                allowHTML: false,
                removeItemButton: element.dataset.removeItemButton === 'true'
            });
        }
    });

    // Initialize Stepper immediately and ensure first step is visible
    const stepperElement = document.querySelector('#stepper');
    console.log('Stepper element found:', !!stepperElement);
    console.log('Stepper library available:', typeof Stepper !== 'undefined');
    
    // Create custom stepper object
    window.stepper = {
        currentIndex: 0,
        totalSteps: 4,
        
        next: function() {
            console.log('Current index before move:', this.currentIndex);
            console.log('Total steps:', this.totalSteps);
            
            if (this.currentIndex < this.totalSteps - 1) {
                console.log('Moving from step', this.currentIndex + 1, 'to step', this.currentIndex + 2);
                
                // Hide current step
                const currentStep = document.querySelector(`#step-${this.currentIndex + 1}`);
                console.log('Current step element found:', !!currentStep, 'ID:', `#step-${this.currentIndex + 1}`);
                if (currentStep) {
                    console.log('Hiding step:', currentStep.id);
                    currentStep.style.display = 'none';
                    currentStep.style.opacity = '0';
                    currentStep.style.visibility = 'hidden';
                    currentStep.classList.remove('active');
                }
                
                // Increment index
                this.currentIndex++;
                console.log('Index after increment:', this.currentIndex);
                
                // Show next step
                const nextStepId = `#step-${this.currentIndex + 1}`;
                const nextStep = document.querySelector(nextStepId);
                console.log('Next step element found:', !!nextStep, 'ID:', nextStepId);
                if (nextStep) {
                    console.log('Showing step:', nextStep.id);
                    nextStep.style.display = 'block';
                    nextStep.style.opacity = '1';
                    nextStep.style.visibility = 'visible';
                    nextStep.classList.add('active');
                } else {
                    console.log('Next step not found! Available steps:');
                    for (let i = 1; i <= 4; i++) {
                        const step = document.querySelector(`#step-${i}`);
                        console.log(`Step ${i}:`, !!step, step ? step.id : 'null');
                    }
                }
                
                // Update step indicators
                this.updateStepIndicators();
                
                console.log('Successfully moved to step:', this.currentIndex + 1);
            } else {
                console.log('Already at last step');
            }
        },
        
        previous: function() {
            if (this.currentIndex > 0) {
                console.log('Moving from step', this.currentIndex + 1, 'to step', this.currentIndex);
                
                // Hide current step
                const currentStep = document.querySelector(`#step-${this.currentIndex + 1}`);
                if (currentStep) {
                    console.log('Hiding step:', currentStep.id);
                    currentStep.style.display = 'none';
                    currentStep.style.opacity = '0';
                    currentStep.style.visibility = 'hidden';
                    currentStep.classList.remove('active');
                }
                
                // Decrement index
                this.currentIndex--;
                
                // Show previous step
                const prevStep = document.querySelector(`#step-${this.currentIndex + 1}`);
                if (prevStep) {
                    console.log('Showing step:', prevStep.id);
                    prevStep.style.display = 'block';
                    prevStep.style.opacity = '1';
                    prevStep.style.visibility = 'visible';
                    prevStep.classList.add('active');
                }
                
                // Update step indicators
                this.updateStepIndicators();
                
                console.log('Successfully moved to step:', this.currentIndex + 1);
            } else {
                console.log('Already at first step');
            }
        },
        
        updateStepIndicators: function() {
            // Update step indicator classes
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < this.currentIndex) {
                    step.classList.add('completed');
                } else if (index === this.currentIndex) {
                    step.classList.add('active');
                }
            });
        }
    };
    
    // Force first step to be visible
    const firstStep = document.querySelector('#step-1');
    console.log('First step found:', !!firstStep);
    if (firstStep) {
        firstStep.style.display = 'block';
        firstStep.classList.add('active');
        console.log('First step made visible');
    }
    
    // Check all steps exist
    for (let i = 1; i <= 4; i++) {
        const step = document.querySelector(`#step-${i}`);
        console.log(`Step ${i} found:`, !!step, 'ID:', `#step-${i}`);
    }
    
    // Hide other steps initially
    document.querySelector('#step-2').style.display = 'none';
    document.querySelector('#step-3').style.display = 'none';
    document.querySelector('#step-4').style.display = 'none';
    
    // Manual button handlers
    document.querySelectorAll('.next-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Next button clicked');
            window.stepper.next();
        });
    });
    
    document.querySelectorAll('.previous-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Previous button clicked');
            window.stepper.previous();
        });
    });
    
    console.log('Custom stepper initialized');

    // Initialize AOS
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 800,
            once: true
        });
    }

    // Initialize Glightbox
    if (typeof GLightbox !== 'undefined') {
        const lightbox = GLightbox({
            selector: '.glightbox'
        });
    }

    // File upload preview
    const courseImageInput = document.getElementById('courseImage');
    if (courseImageInput) {
        courseImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.querySelector('.border-dashed img');
                    if (img) {
                        img.src = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
            }
        });
    }
});

// Chapter management functions
window.addChapter = function() {
    const container = document.getElementById('chaptersContainer');
    if (!container) return;
    
    const chapterCount = container.children.length + 1;
    
    const chapterHtml = `
        <div class="card mb-3 chapter-item">
            <div class="card-header bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <input type="text" class="form-control form-control-sm" placeholder="Chapter ${chapterCount}: Title" style="max-width: 400px;">
                    <button type="button" class="btn btn-sm btn-danger" onclick="removeChapter(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addLesson(this)">
                        <i class="fas fa-plus"></i> Add Lesson
                    </button>
                </div>
                <div class="lessons-container">
                    <!-- Lesson 1 -->
                    <div class="d-flex align-items-center mb-2 lesson-item">
                        <i class="fas fa-play-circle me-2"></i>
                        <input type="text" class="form-control form-control-sm me-2" placeholder="Lesson title">
                        <input type="text" class="form-control form-control-sm me-2" placeholder="Duration (e.g., 15:30)">
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeLesson(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('beforeend', chapterHtml);
};

window.removeChapter = function(button) {
    const chapter = button.closest('.chapter-item');
    if (chapter) {
        chapter.remove();
    }
};

window.addLesson = function(button) {
    const lessonsContainer = button.closest('.card-body')?.querySelector('.lessons-container');
    if (!lessonsContainer) return;
    
    const lessonHtml = `
        <div class="d-flex align-items-center mb-2 lesson-item">
            <i class="fas fa-play-circle me-2"></i>
            <input type="text" class="form-control form-control-sm me-2" placeholder="Lesson title">
            <input type="text" class="form-control form-control-sm me-2" placeholder="Duration (e.g., 15:30)">
            <button type="button" class="btn btn-sm btn-danger" onclick="removeLesson(this)">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    lessonsContainer.insertAdjacentHTML('beforeend', lessonHtml);
};

window.removeLesson = function(button) {
    const lesson = button.closest('.lesson-item');
    if (lesson) {
        lesson.remove();
    }
};

// Form submission
window.submitCourse = function() {
    // Collect data from all step forms
    const step1Form = document.getElementById('courseForm');
    const step2Form = document.getElementById('courseForm2');
    const step3Form = document.getElementById('courseForm3');
    const step4Form = document.getElementById('courseForm4');
    
    // Create a unified form data object
    const allFormData = new FormData();
    
    // Collect data from each step form
    [step1Form, step2Form, step3Form, step4Form].forEach(form => {
        if (form) {
            const formData = new FormData(form);
            for (let [key, value] of formData.entries()) {
                allFormData.set(key, value);
            }
        }
    });
    
    // Collect chapters and lessons
    const chapters = [];
    document.querySelectorAll('.chapter-item').forEach((chapterEl, index) => {
        const chapterTitleInput = chapterEl.querySelector('input[type="text"]');
        const chapterTitle = chapterTitleInput ? chapterTitleInput.value : '';
        const lessons = [];
        
        chapterEl.querySelectorAll('.lesson-item').forEach(lessonEl => {
            const lessonInputs = lessonEl.querySelectorAll('input[type="text"]');
            if (lessonInputs.length >= 2) {
                lessons.push({
                    title: lessonInputs[0].value,
                    duration: lessonInputs[1].value
                });
            }
        });
        
        chapters.push({
            title: chapterTitle,
            lessons: lessons
        });
    });
    
    allFormData.set('chapters', JSON.stringify(chapters));
    
    // Add file inputs
    const courseImage = document.getElementById('courseImage').files[0];
    if (courseImage) {
        allFormData.append('course_image', courseImage);
    }
    
    const courseVideo = document.getElementById('courseVideo').files[0];
    if (courseVideo) {
        allFormData.append('course_video', courseVideo);
    }

    // Submit via XMLHttpRequest
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '{{ path('app_course_create_submit') }}', true);

    // Show overlay
    const overlay = document.getElementById('uploadOverlay');
    const progressBar = document.getElementById('uploadProgressBar');
    const statusText = document.getElementById('uploadStatusText');
    const statusTitle = document.getElementById('uploadStatusTitle');
    const uploadWarning = document.getElementById('uploadWarning');
    const uploadSpinner = document.getElementById('uploadSpinner');
    
    if (overlay) {
        overlay.style.display = 'flex';
        progressBar.style.width = '0%';
        progressBar.textContent = '0%';
        progressBar.classList.remove('bg-success', 'bg-danger');
        progressBar.classList.add('bg-primary');
        statusTitle.textContent = 'Saving Course...';
        statusText.textContent = 'Creating course record...';
        uploadWarning.style.display = 'none';
        uploadSpinner.style.display = 'inline-block';
        document.body.style.cursor = 'wait';
    }

    xhr.onload = function() {
        if (xhr.status === 200) {
            try {
                const data = JSON.parse(xhr.responseText);
                if (data.status === 'success') {
                    // Course saved! Show success immediately
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    statusTitle.textContent = "Course Created!";
                    statusText.textContent = "Course saved successfully!";
                    
                    // If there's a video, trigger background upload
                    if (data.has_video && data.course_id) {
                        // Show upload is happening in background
                        setTimeout(() => {
                            statusTitle.textContent = "Uploading Video...";
                            statusText.innerHTML = "Your course is saved!<br>Video is uploading in the background.<br><small>You can close this window.</small>";
                            uploadWarning.style.display = 'block';
                            uploadWarning.textContent = "Feel free to navigate away - upload continues in background";
                            uploadWarning.classList.remove('text-danger');
                            uploadWarning.classList.add('text-info');
                            progressBar.style.width = '0%';
                            progressBar.classList.remove('bg-primary');
                            progressBar.classList.add('bg-info');
                        }, 1000);
                        
                        // Trigger background upload
                        uploadVideoInBackground(data.course_id);
                        
                        // Allow user to navigate away after 3 seconds
                        setTimeout(() => {
                            document.body.style.cursor = 'default';
                            statusText.innerHTML += "<br><br><button class='btn btn-primary' onclick='window.location.href=\"{{ path('app_course_added') }}\"'>Continue</button>";
                        }, 3000);
                        
                    } else {
                        // No video, just redirect
                        document.body.style.cursor = 'default';
                        setTimeout(() => {
                            window.location.href = '{{ path('app_course_added') }}';
                        }, 1500);
                    }
                } else {
                    document.body.style.cursor = 'default';
                    alert('Error: ' + data.message);
                    overlay.style.display = 'none';
                }
            } catch (e) {
                document.body.style.cursor = 'default';
                console.error("JSON Parse Error", e);
                alert('An unexpected error occurred.');
                overlay.style.display = 'none';
            }
        } else {
            document.body.style.cursor = 'default';
            alert('Server Error: ' + xhr.status);
            overlay.style.display = 'none';
        }
    };

    xhr.onerror = function() {
        document.body.style.cursor = 'default';
        alert('Network error occurred.');
        overlay.style.display = 'none';
    };

    // Send the data
    xhr.send(allFormData);
    
    return false; // Prevent form submission
};

// Background video upload function
function uploadVideoInBackground(courseId) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', `/api/course/${courseId}/upload-video`, true);
    
    const overlay = document.getElementById('uploadOverlay');
    const progressBar = document.getElementById('uploadProgressBar');
    const statusText = document.getElementById('uploadStatusText');
    const statusTitle = document.getElementById('uploadStatusTitle');
    
    xhr.upload.onprogress = function(e) {
        if (e.lengthComputable && progressBar) {
            const percentComplete = Math.round((e.loaded / e.total) * 100);
            progressBar.style.width = percentComplete + '%';
            progressBar.textContent = percentComplete + '%';
            
            if (percentComplete < 100) {
                statusText.innerHTML = `Uploading video: ${percentComplete}%<br><small>You can close this window</small>`;
            } else {
                statusTitle.textContent = "Processing...";
                statusText.innerHTML = "Upload complete!<br>Syncing to Mega.nz...<br><small>This may take a few minutes</small>";
                progressBar.classList.remove('bg-info');
                progressBar.classList.add('bg-success');
            }
        }
    };
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            const data = JSON.parse(xhr.responseText);
            if (data.status === 'success') {
                statusTitle.textContent = "Complete!";
                statusText.innerHTML = "Video uploaded successfully!<br>Your course is now live.";
                progressBar.style.width = '100%';
                
                setTimeout(() => {
                    if (overlay) overlay.style.display = 'none';
                }, 2000);
            } else {
                statusTitle.textContent = "Upload Failed";
                statusText.innerHTML = "Video upload failed: " + data.message + "<br>Course was saved, but video is missing.";
                progressBar.classList.remove('bg-success');
                progressBar.classList.add('bg-danger');
            }
        }
    };
    
    xhr.onerror = function() {
        statusTitle.textContent = "Upload Failed";
        statusText.innerHTML = "Network error during video upload.<br>Course was saved, but video is missing.";
    };
    
    // Send empty body (file is already on server)
    xhr.send();
}
</script>
{% endblock %}
