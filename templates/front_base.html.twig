{% extends 'base.html.twig' %}

{% block body %}
<!-- =======================
Header START -->
<header class="navbar-light navbar-sticky header-static">
    <!-- Logo Nav START -->
    <nav class="navbar navbar-expand-xl">
        <div class="container">
            <!-- Logo START -->
            <a class="navbar-brand" href="{{ path('app_home') }}">
                <img class="navbar-brand-item" src="{{ asset('assets/images/logo.svg') }}" alt="logo">
            </a>
            <!-- Logo END -->

            <!-- Responsive navbar toggler -->
            <button class="navbar-toggler ms-auto icon-md btn btn-outline-secondary p-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Main navbar START -->
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav navbar-nav-scroll me-auto">
                    <!-- Search bar START -->
                    <li class="nav-item mx-6" style="margin-top: 8px;">
                        <div class="position-relative">
                            <input class="form-control pe-5 form-control-sm" type="search" name="search" placeholder="Search courses, jobs, products, users..." aria-label="Search" autocomplete="off" id="headerSearchInput" style="width: 300px;">
                            <button class="bg-transparent p-1 position-absolute top-50 end-0 translate-middle-y border-0 text-primary-hover text-reset" type="button" onclick="performSearch()">
                                <i class="fas fa-search fs-6"></i>
                            </button>
                            <div class="autocomplete-suggestions" id="headerSuggestionsContainer" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e9ecef; border-top: none; border-radius: 0 0 20px 20px; box-shadow: 0 16px 40px rgba(0,0,0,0.25); max-height: 650px; overflow-y: auto; z-index: 1000; backdrop-filter: blur(20px); min-width: 600px;"></div>
                        </div>
                    </li>
                    <!-- Search bar END -->
                    
                    <!-- Nav item Courses -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if app.request.attributes.get('_route') starts with 'app_course_grid' %}active{% endif %}" href="#" id="courseDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Courses
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="courseDropdown">
                            <li><h6 class="dropdown-header">Learning</h6></li>
                            <li><a class="dropdown-item" href="{{ path('app_course_grid') }}">Browse Courses</a></li>
                            <li><a class="dropdown-item" href="{{ path('app_categories') }}">Course Categories</a></li>
                            <li><a class="dropdown-item" href="/certificate/browse-certificates">Browse Certificates</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Student</h6></li>
                            <li><a class="dropdown-item" href="#">My Certificates</a></li>
                            <li><a class="dropdown-item" href="#">My Bookmarks</a></li>
                        </ul>
                    </li>

                    <!-- Nav item Sessions -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if app.request.attributes.get('_route') starts with 'session' %}active{% endif %}" href="#" id="sessionDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Sessions
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="sessionDropdown">
                            <li><h6 class="dropdown-header">Schedule</h6></li>
                            <li><a class="dropdown-item" href="{{ path('all_sessions') }}">All Sessions</a></li>
                            <li><a class="dropdown-item" href="{{ path('all_sessions') }}">Book a Session</a></li>
                            <li><a class="dropdown-item" href="{{ path('all_bookings') }}">My Bookings</a></li>
                        </ul>
                    </li>

                    <!-- Nav item Marketplace -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if app.request.attributes.get('_route') starts with 'app_marketplace' or app.request.attributes.get('_route') starts with 'app_product' or app.request.attributes.get('_route') starts with 'app_job' %}active{% endif %}" href="#" id="marketplaceDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Marketplace
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="marketplaceDropdown">
                            <li><h6 class="dropdown-header">Services</h6></li>
                            <li><a class="dropdown-item {% if app.request.attributes.get('_route') == 'app_marketplace_shop' %}active{% endif %}" href="{{ path('app_marketplace_shop') }}">Browse Marketplace</a></li>
                            <li><a class="dropdown-item {% if app.request.attributes.get('_route') == 'app_product_new_public' %}active{% endif %}" href="{{ path('app_product_new_public') }}">Offer Service</a></li>
                            <li><a class="dropdown-item {% if app.request.attributes.get('_route') starts with 'app_job' %}active{% endif %}" href="#">Job Requests</a></li>
                        </ul>
                    </li>


                    <!-- Nav item Support -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="supportDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Support
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="supportDropdown">
                            <li><h6 class="dropdown-header">Help</h6></li>
                            <li><a class="dropdown-item" href="#">Help Center</a></li>
                            <li><a class="dropdown-item" href="#">Contact Support</a></li>
                            <li><a class="dropdown-item" href="#">FAQ</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">About</h6></li>
                            <li><a class="dropdown-item" href="#">About Us</a></li>
                            <li><a class="dropdown-item" href="#">Contact</a></li>
                            <li><a class="dropdown-item" href="#">Privacy Policy</a></li>
                            <li><a class="dropdown-item" href="#">Terms of Service</a></li>
                        </ul>
                    </li>
                </ul>

                
                <!-- Nav right side START -->
                <ul class="nav flex-row align-items-center list-unstyled ms-xl-auto">
                    <!-- Authentication START -->
                    {% if app.user %}
                        <!-- Profile dropdown START -->
                        <li class="nav-item dropdown">
                            <a class="nav-link avatar avatar-sm p-0" href="#" id="profileDropdown" role="button" data-bs-auto-close="outside" data-bs-display="static" data-bs-toggle="dropdown" aria-expanded="false">
                                <img class="avatar-img rounded-circle" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="avatar">
                            </a>
                            <ul class="dropdown-menu dropdown-animation dropdown-menu-end shadow pt-3" aria-labelledby="profileDropdown">
                                <!-- Profile info -->
                                <li class="px-3 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar me-3">
                                            <img class="avatar-img rounded-circle" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="avatar">
                                        </div>
                                        <div>
                                            <a class="h6 mt-2 mt-sm-0" href="#">{{ app.user.name|default(app.user.email) }}</a>
                                            <p class="small m-0">{{ app.user.email }}</p>
                                        </div>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <!-- Links -->
                                {% if app.user and 'ROLE_INSTRUCTOR' in app.user.roles %}
                                    <li><a class="dropdown-item" href="{{ path('app_profile_edit') }}"><i class="bi bi-pencil-square fa-fw me-2"></i>Edit Profile</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-shopping-cart fa-fw me-2"></i>My Orders</a></li>
                                    <li><a class="dropdown-item" href="{{ path('app_instructor_dashboard') }}"><i class="fas fa-chalkboard-teacher fa-fw me-2"></i>Dashboard</a></li>
                                {% elseif app.user and 'ROLE_STUDENT' in app.user.roles %}
                                    <li><a class="dropdown-item" href="{{ path('app_profile_edit') }}"><i class="bi bi-pencil-square fa-fw me-2"></i>Edit Profile</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-shopping-cart fa-fw me-2"></i>My Orders</a></li>
                                    <li><a class="dropdown-item" href="{{ path('app_student_dashboard') }}"><i class="fas fa-graduation-cap fa-fw me-2"></i>Dashboard</a></li>
                                {% else %}
                                    <li><a class="dropdown-item" href="{{ path('app_admin_dashboard') }}"><i class="fas fa-tachometer-alt fa-fw me-2"></i>Dashboard</a></li>
                                    <li><a class="dropdown-item" href="{{ path('app_profile_edit') }}"><i class="bi bi-pencil-square fa-fw me-2"></i>Edit Profile</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="bi bi-gear fa-fw me-2"></i>Account Settings</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="bi bi-info-circle fa-fw me-2"></i>Help</a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item bg-danger-soft-hover" href="{{ path('app_logout') }}"><i class="fas fa-sign-out-alt fa-fw me-2"></i>Sign Out</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <!-- Sign in button -->
                        <li class="nav-item">
                            <a class="btn btn-sm btn-primary me-2" href="{{ path('app_login') }}">Sign In</a>
                        </li>
                        <!-- Sign up button -->
                        <li class="nav-item">
                            <a class="btn btn-sm btn-outline-primary" href="{{ path('app_register') }}">Sign Up</a>
                        </li>
                    {% endif %}
                    <!-- Authentication END -->
                </ul>
            </div>
        </div>
    </nav>
    <!-- Logo Nav END -->
</header>
<!-- =======================
Header END -->

{% block content %}{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('headerSearchInput');
    const suggestionsContainer = document.getElementById('headerSuggestionsContainer');
    let debounceTimer;

    if (!searchInput || !suggestionsContainer) return;

    searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();
        
        if (debounceTimer) clearTimeout(debounceTimer);
        
        if (query.length < 2) {
            suggestionsContainer.style.display = 'none';
            return;
        }
        
        debounceTimer = setTimeout(() => {
            fetchSuggestions(query);
        }, 300);
    });

    searchInput.addEventListener('focus', () => {
        if (searchInput.value.trim().length >= 2) {
            suggestionsContainer.style.display = 'block';
        }
    });

    searchInput.addEventListener('blur', () => {
        setTimeout(() => {
            suggestionsContainer.style.display = 'none';
        }, 200);
    });

    async function fetchSuggestions(query) {
        try {
            const response = await fetch(`/api/autocomplete/universal?q=${encodeURIComponent(query)}&limit=5`);
            const data = await response.json();
            
            if (data.success && data.suggestions.length > 0) {
                const html = data.suggestions.map(suggestion => {
                    let typeIcon = '';
                    let typeColor = '';
                    let detailsHtml = '';
                    
                    if (suggestion.type === 'course') {
                        typeIcon = 'üìö';
                        typeColor = '#e3f2fd';
                        detailsHtml = `
                            <div style="color: #495057; font-size: 15px; margin-bottom: 10px; line-height: 1.6; font-weight: 400; letter-spacing: 0.01em;">${suggestion.description ? suggestion.description.substring(0, 90) + '...' : ''}</div>
                            <div style="display: flex; gap: 12px; font-size: 13px; align-items: center; flex-wrap: wrap;">
                                <span style="background: linear-gradient(135deg, #e3f2fd, #1976d2); color: white; padding: 6px 14px; border-radius: 20px; font-weight: 700; box-shadow: 0 4px 12px rgba(25,118,210,0.5); border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(2px); text-shadow: 0 1px 2px rgba(0,0,0,0.2);">${suggestion.level || 'All levels'}</span>
                                <span style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 6px 14px; border-radius: 20px; font-weight: 800; box-shadow: 0 4px 12px rgba(40,167,69,0.5); border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(2px); text-shadow: 0 1px 2px rgba(0,0,0,0.2);">$${suggestion.price || '0'}</span>
                            </div>
                        `;
                    } else if (suggestion.type === 'job') {
                        typeIcon = 'üíº';
                        typeColor = '#28a745';
                        detailsHtml = `
                            <div style="color: #495057; font-size: 15px; margin-bottom: 10px; line-height: 1.6; font-weight: 400; letter-spacing: 0.01em;">${suggestion.description ? suggestion.description.substring(0, 90) + '...' : ''}</div>
                            <div style="display: flex; gap: 12px; font-size: 13px; align-items: center;">
                                <span style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 6px 14px; border-radius: 20px; font-weight: 700; box-shadow: 0 4px 12px rgba(40,167,69,0.5); border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(2px); text-shadow: 0 1px 2px rgba(0,0,0,0.2);">üíº Job Opportunity</span>
                            </div>
                        `;
                    } else if (suggestion.type === 'product') {
                        typeIcon = 'üõçÔ∏è';
                        typeColor = '#fd7e14';
                        detailsHtml = `
                            <div style="color: #495057; font-size: 15px; margin-bottom: 10px; line-height: 1.6; font-weight: 400; letter-spacing: 0.01em;">${suggestion.description ? suggestion.description.substring(0, 90) + '...' : ''}</div>
                            <div style="display: flex; gap: 12px; font-size: 13px; align-items: center;">
                                <span style="background: linear-gradient(135deg, #fd7e14, #e67e22); color: white; padding: 6px 14px; border-radius: 20px; font-weight: 800; box-shadow: 0 4px 12px rgba(253,126,20,0.5); border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(2px); text-shadow: 0 1px 2px rgba(0,0,0,0.2);">$${suggestion.price || '0'}</span>
                            </div>
                        `;
                    } else if (suggestion.type === 'user') {
                        typeIcon = 'üë§';
                        typeColor = '#6f42c1';
                        detailsHtml = `
                            <div style="color: #495057; font-size: 15px; margin-bottom: 10px; line-height: 1.6; font-weight: 400; letter-spacing: 0.01em;">${suggestion.description}</div>
                            <div style="display: flex; gap: 12px; font-size: 13px; align-items: center;">
                                <span style="background: linear-gradient(135deg, #6f42c1, #5a2d82); color: white; padding: 6px 14px; border-radius: 20px; font-weight: 700; box-shadow: 0 4px 12px rgba(111,66,193,0.5); border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(2px); text-shadow: 0 1px 2px rgba(0,0,0,0.2);">üë§ User Profile</span>
                            </div>
                        `;
                    }
                    
                    return `
                        <div class="autocomplete-item" style="padding: 28px; cursor: pointer; border-bottom: 1px solid rgba(248, 249, 250, 0.06); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 20px; position: relative; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0)); backdrop-filter: blur(2px);" 
                             onmouseover="this.style.background='linear-gradient(135deg, rgba(248, 249, 250, 0.2), rgba(248, 249, 250, 0.35))'; this.style.transform='translateX(12px) scale(1.06) translateY(-4px)'; this.style.boxShadow='0 12px 48px rgba(0,0,0,0.35)'; this.querySelector('.autocomplete-icon').style.transform='rotateY(180deg) scale(1.25) rotate(360deg)'; this.querySelector('.autocomplete-content').style.opacity='0.85'" 
                             onmouseout="this.style.background='linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0))'; this.style.transform='translateX(0) scale(1) translateY(0)'; this.style.boxShadow='none'; this.querySelector('.autocomplete-icon').style.transform='rotateY(0deg) scale(1) rotate(0deg)'; this.querySelector('.autocomplete-content').style.opacity='1'"
                             onclick="selectCourse('${suggestion.title}', '${suggestion.url}')">
                            <div style="display: flex; align-items: center; justify-content: center; width: 64px; height: 64px; background: linear-gradient(135deg, ${typeColor}, ${typeColor}dd); border-radius: 20px; flex-shrink: 0; box-shadow: 0 12px 36px rgba(0,0,0,0.35); position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%); border-radius: 20px; animation: shimmer 1.5s infinite;"></div>
                                <div style="position: absolute; top: 5px; left: 5px; right: 5px; bottom: 5px; background: linear-gradient(45deg, rgba(255,255,255,0.35), rgba(255,255,255,0.2) 50%, transparent 70%); border-radius: 16px;"></div>
                                <div style="position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; background: linear-gradient(45deg, rgba(255,255,255,0.2), rgba(255,255,255,0.08) 50%, transparent 70%); border-radius: 14px;"></div>
                                <span class="autocomplete-icon" style="font-size: 30px; color: white; position: relative; z-index: 4; text-shadow: 0 5px 10px rgba(0,0,0,0.7); transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5)); animation: pulse 2s infinite;">${typeIcon}</span>
                            </div>
                            <div class="autocomplete-content" style="flex: 1; min-width: 0; transition: opacity 0.5s ease;">
                                <div style="font-weight: 800; color: #0a0a0a; margin-bottom: 16px; font-size: 20px; line-height: 1.4; letter-spacing: -0.04em; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">${suggestion.title}</div>
                                ${detailsHtml}
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; color: #6c757d; font-size: 14px; opacity: 0.85;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <i class="fas fa-arrow-right" style="transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: center;"></i>
                                </div>
                                <div style="font-size: 14px; background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0.25)); padding: 8px 16px; border-radius: 16px; font-weight: 700; border: 1px solid rgba(255,255,255,0.6); box-shadow: 0 6px 16px rgba(0,0,0,0.2); backdrop-filter: blur(2px); text-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                    ${suggestion.type === 'course' ? 'üìö Course' : suggestion.type === 'job' ? 'üíº Job' : suggestion.type === 'product' ? 'üõçÔ∏è Product' : 'üë§ User'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                suggestionsContainer.innerHTML = html;
                suggestionsContainer.style.display = 'block';
            } else {
                const noResultsHtml = `
                    <div style="padding: 40px; text-align: center; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                        <div style="margin-bottom: 20px;">
                            <div style="display: inline-flex; align-items: center; justify-content: center; width: 80px; height: 80px; background: linear-gradient(135deg, #e9ecef, #dee2e6); border-radius: 50%; box-shadow: 0 8px 16px rgba(0,0,0,0.1); position: relative;">
                                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%); border-radius: 50%;"></div>
                                <i class="fas fa-search" style="font-size: 32px; color: #6c757d; position: relative; z-index: 1;"></i>
                            </div>
                        </div>
                        <div style="font-weight: 700; margin-bottom: 12px; font-size: 18px; color: #495057; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">No results found</div>
                        <div style="font-size: 15px; color: #6c757d; margin-bottom: 20px; line-height: 1.5;">Try checking your spelling or explore different categories</div>
                        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                            <div style="background: linear-gradient(135deg, #e3f2fd, #1976d2); color: white; padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; box-shadow: 0 4px 8px rgba(25,118,210,0.3); transition: all 0.3s ease; cursor: pointer;" 
                                 onmouseover="this.style.transform='translateY(-2px) scale(1.05)'" 
                                 onmouseout="this.style.transform='translateY(0) scale(1)'">
                                üìö Browse Courses
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; box-shadow: 0 4px 8px rgba(40,167,69,0.3); transition: all 0.3s ease; cursor: pointer;" 
                                 onmouseover="this.style.transform='translateY(-2px) scale(1.05)'" 
                                 onmouseout="this.style.transform='translateY(0) scale(1)'">
                                üíº Find Jobs
                            </div>
                            <div style="background: linear-gradient(135deg, #fd7e14, #e67e22); color: white; padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; box-shadow: 0 4px 8px rgba(253,126,20,0.3); transition: all 0.3s ease; cursor: pointer;" 
                                 onmouseover="this.style.transform='translateY(-2px) scale(1.05)'" 
                                 onmouseout="this.style.transform='translateY(0) scale(1)'">
                                üõçÔ∏è Shop Products
                            </div>
                            <div style="background: linear-gradient(135deg, #6f42c1, #5a2d82); color: white; padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; box-shadow: 0 4px 8px rgba(111,66,193,0.3); transition: all 0.3s ease; cursor: pointer;" 
                                 onmouseover="this.style.transform='translateY(-2px) scale(1.05)'" 
                                 onmouseout="this.style.transform='translateY(0) scale(1)'">
                                üë§ Connect Users
                            </div>
                        </div>
                    </div>
                `;
                suggestionsContainer.innerHTML = noResultsHtml;
                suggestionsContainer.style.display = 'block';
            }
        } catch (error) {
            console.error('Autocomplete error:', error);
            suggestionsContainer.style.display = 'none';
        }
    }

    window.selectCourse = function(title, url) {
        searchInput.value = title;
        suggestionsContainer.style.display = 'none';
        if (url) {
            window.location.href = url;
        }
    };

    window.performSearch = function() {
        const query = searchInput.value.trim();
        if (query) {
            // Ultra-intelligent category detection with fuzzy matching and variations
            const categories = {
                'development': ['development', 'dev', 'coding', 'programming', 'web dev', 'software', 'app development', 'javascript', 'python', 'react', 'nodejs', 'frontend', 'backend'],
                'design': ['design', 'ui', 'ux', 'user interface', 'graphic', 'web design', 'logo design', 'branding', 'visual', 'photoshop', 'figma', 'sketch'],
                'business': ['business', 'marketing', 'sales', 'entrepreneurship', 'management', 'startup', 'finance', 'strategy', 'consulting'],
                'data-science': ['data science', 'data', 'analytics', 'machine learning', 'ai', 'artificial intelligence', 'deep learning', 'python', 'r', 'statistics'],
                'photography': ['photography', 'photo', 'camera', 'video', 'editing', 'lightroom', 'photoshop', 'canon', 'nikon'],
                'music': ['music', 'audio', 'sound', 'production', 'mixing', 'mastering', 'ableton', 'logic', 'fl studio'],
                'languages': ['language', 'english', 'french', 'spanish', 'german', 'chinese', 'japanese', 'korean', 'arabic', 'spanish']
            };
            
            let matchedCategory = null;
            const lowerQuery = query.toLowerCase();
            
            // Enhanced fuzzy matching with partial words and variations
            const queryWords = lowerQuery.split(' ');
            
            for (const [category, keywords] of Object.entries(categories)) {
                let categoryScore = 0;
                
                for (const keyword of keywords) {
                    // Exact match gets highest score
                    if (lowerQuery === keyword) {
                        categoryScore += 10;
                    }
                    // Partial word match gets medium score
                    else if (queryWords.some(word => keyword.includes(word) || word.includes(keyword))) {
                        categoryScore += 5;
                    }
                    // Contains match gets lower score
                    else if (lowerQuery.includes(keyword)) {
                        categoryScore += 2;
                    }
                    // Handle variations and typos
                    else if (keyword.includes('design') && lowerQuery.includes('desig')) {
                        categoryScore += 3;
                    }
                    else if (keyword.includes('develop') && lowerQuery.includes('develo')) {
                        categoryScore += 3;
                    }
                }
                
                // Update matched category if this has higher score
                if (categoryScore > (matchedCategory ? categories[matchedCategory].score || 0 : 0)) {
                    matchedCategory = category;
                    matchedCategory.score = categoryScore;
                }
            }
            
            if (matchedCategory) {
                // Search for courses in this category
                console.log(`Searching for category: ${matchedCategory}`);
                window.location.href = `/courses?category=${encodeURIComponent(matchedCategory)}&search=${encodeURIComponent(query)}`;
            } else {
                // General search across all content
                console.log('General search across all content');
                window.location.href = `/search?query=${encodeURIComponent(query)}`;
            }
        }
    };

    // Handle Enter key
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            performSearch();
        }
    });
});
</script>

{% endblock %}
