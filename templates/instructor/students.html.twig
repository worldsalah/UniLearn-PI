{% extends 'front_base.html.twig' %}

{% block title %}Students - Eduport{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ asset('assets/vendor/choices/css/choices.min.css') }}">
<style>
/* Modern Instructor Dashboard Styles */
.instructor-gradient {
    background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
    position: relative;
    overflow: hidden;
}
.instructor-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('{{ asset('assets/images/pattern/04.png') }}') no-repeat center center;
    background-size: cover;
    opacity: 0.1;
}
.profile-banner {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
}
.profile-banner::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(13, 110, 253, 0.05) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
}
.avatar-enhanced {
    border: 4px solid white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}
.avatar-enhanced:hover {
    transform: scale(1.05);
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}
.create-course-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}
.create-course-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    color: white;
}
.verified-badge {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}
.table-modern {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.table-modern thead th {
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    color: #495057;
    padding: 1rem;
}
.table-modern tbody td {
    padding: 1rem;
    vertical-align: middle;
    border-bottom: 1px solid #f1f3f5;
}
.table-modern tbody tr:hover {
    background: #f8f9fa;
}
.badge-modern {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 500;
    font-size: 0.875rem;
}
.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.875rem;
}
.user-info {
    flex: 1;
}
.user-name {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.25rem;
}
.user-email {
    color: #6c757d;
    font-size: 0.875rem;
}
.user-meta {
    color: #6c757d;
    font-size: 0.75rem;
    margin-top: 0.25rem;
}
.no-students {
    text-align: center;
    padding: 3rem;
    color: #6c757d;
}
.no-students i {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}
.no-students h6 {
    margin-bottom: 0.5rem;
    color: #495057;
}
.no-students p {
    margin-bottom: 1rem;
}
.search-box {
    position: relative;
}
.search-box input {
    padding-left: 2.5rem;
    border-radius: 25px;
    border: 1px solid #dee2e6;
}
.search-box i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
}
.stats-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
    border-left: 4px solid #007bff;
}
.stats-card h3 {
    margin: 0 0 0.5rem 0;
    font-size: 2rem;
    font-weight: 700;
    color: #007bff;
}
.stats-card p {
    margin: 0;
    color: #6c757d;
    font-size: 0.875rem;
}
.stats-card.active {
    border-left-color: #28a745;
}
.stats-card.active h3 {
    color: #28a745;
}
.stats-card.inactive {
    border-left-color: #dc3545;
}
.stats-card.inactive h3 {
    color: #dc3545;
}
.sidebar-modern {
    background: #212529;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.sidebar-modern .list-group-item {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.8);
    transition: all 0.3s ease;
    border-radius: 10px;
    margin: 5px;
}
.sidebar-modern .list-group-item:hover {
    background: rgba(255,255,255,0.1);
    color: white;
    transform: translateX(5px);
}
.sidebar-modern .list-group-item.active {
    background: rgba(255,255,255,0.2);
    color: white;
}
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
}
</style>
{% endblock %}

{% block content %}

<!-- **************** MAIN CONTENT START **************** -->
<main>
	
<!-- =======================
Page Banner START -->
<section class="pt-0">
	<!-- Main banner background image -->
	<div class="container-fluid px-0">
		<div class="bg-blue h-100px h-md-200px rounded-0" style="background:url({{ asset('assets/images/pattern/04.png') }}) no-repeat center center; background-size:cover;">
		</div>
	</div>
	<div class="container mt-n4">
		<div class="row">
			<!-- Profile banner START -->
			<div class="col-12">
				<div class="profile-banner card-body p-4">
					<div class="row d-flex justify-content-between">
						<!-- Avatar -->
						<div class="col-auto mt-4 mt-md-0">
							<div class="avatar avatar-xxl mt-n3 position-relative">
								<img class="avatar-img rounded-circle avatar-enhanced" src="{{ asset('assets/images/avatar/01.jpg') }}" alt="">
								<div class="position-absolute bottom-0 end-0">
									<span class="verified-badge">
										<i class="bi bi-patch-check-fill"></i> Verified
									</span>
								</div>
							</div>
						</div>
						<!-- Profile info -->
						<div class="col d-md-flex justify-content-between align-items-center mt-4">
							<div>
								<h1 class="my-1 fs-3 fw-bold">{{ teacher.name }}'s Students</h1>
								<div class="d-flex flex-wrap align-items-center gap-3 mb-2">
									<span class="badge bg-warning bg-opacity-10 text-warning">
										<i class="fas fa-envelope me-1"></i>{{ teacher.email }}
									</span>
									<span class="badge bg-purple bg-opacity-10 text-purple">
										<i class="fas fa-users me-1"></i>{{ totalUsers }} Students
									</span>
									<span class="badge bg-orange bg-opacity-10 text-orange">
										<i class="fas fa-user-tag me-1"></i>{{ teacher.role.name|capitalize }}
									</span>
								</div>
								<p class="text-muted mb-0">Professional Instructor | Student Management | Educator</p>
							</div>
							<!-- Button -->
							<div class="d-flex align-items-center mt-2 mt-md-0">
								<a href="{{ path('app_instructor_dashboard') }}" class="create-course-btn">
									<i class="fas fa-arrow-left me-2"></i>Back to Dashboard
								</a>
							</div>
						</div>
					</div>
				</div>
				<!-- Profile banner END -->

				<!-- Advanced filter responsive toggler START -->
				<!-- Divider -->
				<hr class="d-xl-none">
				<div class="col-12 col-xl-3 d-flex justify-content-between align-items-center">
					<a class="h6 mb-0 fw-bold d-xl-none" href="#">Menu</a>
					<button class="btn btn-primary d-xl-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
						<i class="fas fa-sliders-h"></i>
					</button>
				</div>
				<!-- Advanced filter responsive toggler END -->
			</div>
		</div>
	</div>
</section>
<!-- =======================
Page Banner END -->

<!-- =======================
Page content START -->
<section class="pt-0">
	<div class="container">
		<div class="row">
			<!-- Left sidebar START -->
			<div class="col-xl-3">
				<!-- Responsive offcanvas body START -->
				<div class="offcanvas-xl offcanvas-end" tabindex="-1" id="offcanvasSidebar">
					<!-- Offcanvas header -->
					<div class="offcanvas-header bg-light">
						<h5 class="offcanvas-title" id="offcanvasNavbarLabel">My profile</h5>
						<button  type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasSidebar" aria-label="Close"></button>
					</div>
					<!-- Offcanvas body -->
					<div class="offcanvas-body p-3 p-xl-0">
						{% include 'instructor/_sidebar.html.twig' %}
					</div>
				</div>
				<!-- Responsive offcanvas body END -->
			</div>
			<!-- Left sidebar END -->

			<!-- Main content START -->
			<div class="col-xl-9">
				<div class="vstack gap-4">
					<!-- Search and select START -->
					<div class="row g-4 align-items-center">
						<div class="col-md-6">
							<div class="search-box">
								<i class="fas fa-search"></i>
								<input type="text" class="form-control" id="studentSearch" placeholder="Search students by name or email...">
							</div>
						</div>
						<div class="col-md-6">
							<div class="d-flex justify-content-end">
								<div>
									<select class="form-select" id="sortSelect">
										<option value="name">Name</option>
										<option value="email">Email</option>
										<option value="role">Role</option>
										<option value="status">Status</option>
										<option value="date">Registration Date</option>
									</select>
								</div>
							</div>
						</div>
					</div>
					<!-- Search and select END -->

					<!-- Statistics Cards -->
					<div class="row g-4">
						<div class="col-md-4">
							<div class="stats-card">
								<h3>{{ totalUsers }}</h3>
								<p>Total Students</p>
							</div>
						</div>
						<div class="col-md-4">
							<div class="stats-card active">
								<h3>{{ activeUsers }}</h3>
								<p>Active Students</p>
							</div>
						</div>
						<div class="col-md-4">
							<div class="stats-card inactive">
								<h3>{{ inactiveUsers }}</h3>
								<p>Inactive Students</p>
							</div>
						</div>
					</div>

					<!-- Students list START -->
					<div class="table-responsive border-0 rounded-3">
						<table class="table table-modern align-middle mb-0" id="studentsTable">
							<thead>
								<tr>
									<th scope="col" class="border-0 rounded-start">Student Name</th>
									<th scope="col" class="border-0">Role</th>
									<th scope="col" class="border-0">Status</th>
									<th scope="col" class="border-0">Registration Date</th>
									<th scope="col" class="border-0 rounded-end">Action</th>
								</tr>
							</thead>
							<tbody id="studentsTableBody">
								{% if users is empty %}
									<tr>
										<td colspan="5" class="no-students">
											<div class="no-students">
												<i class="fas fa-users"></i>
												<h6>No students found</h6>
												<p>There are no students in the system yet</p>
											</div>
										</td>
									</tr>
								{% else %}
									{% for user in users %}
										<tr data-name="{{ user.fullName|lower }}" data-email="{{ user.email|lower }}" data-role="{{ user.role.name|lower }}" data-status="{{ user.status|lower }}" data-date="{{ user.createdAt|date('Y-m-d') }}">
											<td>
												<div class="d-flex align-items-center">
													<div class="me-3">
														<div class="user-avatar">
															{{ user.fullName|first|upper }}
														</div>
													</div>
													<div class="user-info">
														<div class="user-name">{{ user.fullName }}</div>
														<div class="user-email">{{ user.email }}</div>
														<div class="user-meta">
															<i class="fas fa-calendar me-1"></i>Member since {{ user.createdAt|date('M j, Y') }}
														</div>
													</div>
												</div>
											</td>
											<td>
												<div class="d-flex align-items-center">
													{% set roleClass = user.role.name == 'admin' ? 'bg-danger' : user.role.name == 'instructor' ? 'bg-success' : 'bg-primary' %}
													<span class="badge badge-modern {{ roleClass }}">
														{{ user.role.name|capitalize }}
													</span>
												</div>
											</td>
											<td>
												{% if user.status == 'active' %}
													<span class="badge badge-modern bg-success">Active</span>
												{% elseif user.status == 'inactive' %}
													<span class="badge badge-modern bg-secondary">Inactive</span>
												{% else %}
													<span class="badge badge-modern bg-info">{{ user.status|capitalize }}</span>
												{% endif %}
											</td>
											<td>
												<div class="d-flex align-items-center">
													<i class="fas fa-calendar me-2 text-primary"></i>
													<span>{{ user.createdAt|date('M j, Y') }}</span>
												</div>
											</td>
											<td>
												<div class="d-flex gap-2">
													<button type="button" class="btn btn-sm btn-outline-primary" onclick="viewStudentDetails({{ user.id }})">
														<i class="fas fa-eye"></i>
													</button>
													<button type="button" class="btn btn-sm btn-outline-info" onclick="messageStudent({{ user.id }})">
														<i class="fas fa-envelope"></i>
													</button>
												</div>
											</td>
										</tr>
									{% endfor %}
								{% endif %}
							</tbody>
						</table>
					</div>
					<!-- Students list END -->
				</div>
			</div>
			<!-- Main content END -->
		</div>
	</div>
</section>
<!-- =======================
Page content END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->

{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Student search functionality
    const searchInput = document.getElementById('studentSearch');
    const sortSelect = document.getElementById('sortSelect');
    const tableBody = document.getElementById('studentsTableBody');
    
    if (searchInput && tableBody) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = tableBody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const name = row.getAttribute('data-name') || '';
                const email = row.getAttribute('data-email') || '';
                
                if (name.includes(searchTerm) || email.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        });
    }
    
    // Sort functionality
    if (sortSelect && tableBody) {
        sortSelect.addEventListener('change', function() {
            const sortBy = this.value;
            const rows = Array.from(tableBody.getElementsByTagName('tr'));
            
            // Skip the "no students" row
            const dataRows = rows.filter(row => row.getAttribute('data-name'));
            
            dataRows.sort((a, b) => {
                let aValue, bValue;
                
                switch(sortBy) {
                    case 'name':
                        aValue = a.getAttribute('data-name');
                        bValue = b.getAttribute('data-name');
                        break;
                    case 'email':
                        aValue = a.getAttribute('data-email');
                        bValue = b.getAttribute('data-email');
                        break;
                    case 'role':
                        aValue = a.getAttribute('data-role');
                        bValue = b.getAttribute('data-role');
                        break;
                    case 'status':
                        aValue = a.getAttribute('data-status');
                        bValue = b.getAttribute('data-status');
                        break;
                    case 'date':
                        aValue = a.getAttribute('data-date');
                        bValue = b.getAttribute('data-date');
                        break;
                    default:
                        aValue = a.getAttribute('data-name');
                        bValue = b.getAttribute('data-name');
                }
                
                if (aValue < bValue) return -1;
                if (aValue > bValue) return 1;
                return 0;
            });
            
            // Reorder rows
            dataRows.forEach(row => tableBody.appendChild(row));
        });
    }
});

function viewStudentDetails(studentId) {
    console.log('Viewing details for student:', studentId);
    // You can implement a modal or navigate to a detailed page
    alert('Student details view would be implemented here. Student ID: ' + studentId);
}

function messageStudent(studentId) {
    console.log('Messaging student:', studentId);
    // You can implement a messaging modal or navigate to messaging page
    alert('Messaging interface would be implemented here. Student ID: ' + studentId);
}
</script>
{% endblock %}
