{% extends 'front_base.html.twig' %}

{% block title %}Marketplace - Services & Jobs - Unilearn Marketplace{% endblock %}

{% block content %}

<!-- =======================
Page Banner START -->
<section class="py-0">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="bg-light p-4 rounded-3 position-relative overflow-hidden">

					<!-- Svg decoration -->
					<figure class="position-absolute top-0 end-0 mt-5">
						<svg width="566.3px" height="353.7px" viewBox="0 0 566.3 353.7">
							<path stroke="#17a2b8" fill="none" d="M525.1,4c8.1,0.7,14.9,7.2,17.9,14.8c3,7.6,3,16,2.1,24.1c-4.7,44.3-32.1,84.7-69.4,108.9 c-37.4,24.2-83.7,32.8-127.9,27.6c-32.3-3.8-63.5-14.5-95.9-16.6c-21.6-1.4-45.6,2.1-60.1,18.3c-7.7,8.5-11.8,19.6-14.8,30.7 c-7.9,29.5-9,60.8-19.7,89.5c-5.5,14.8-14,29.1-27.1,38c-15.6,10.5-35.6,12-54.2,9.5c-18.6-2.5-36.5-8.6-55-12.1"/>
							<path stroke="#F99D2B" fill="none" d="M560.7,0.2c10,18.3,3.7,41.1-5,60.1c-11.8,25.9-28,50.3-50.2,68.2c-29,23.3-66.3,34-103.2,38.6 c-36.9,4.6-74.3,3.8-111.3,7.2c-22.3,2-45.3,5.9-63.5,19c-26.8,19.2-39,55.3-68.3,70.4c-38.2,19.6-89.7-4.9-125.6,18.8 c-22.6,15-30.7,44.2-33.3,71.2"/>
						</svg>
					</figure>

					<div class="row position-relative align-items-center">

						<!-- Content -->
						<div class="col-md-6 px-md-5">
							<!-- Title -->
							<h1 class="mb-3">Welcome to our online marketplace!</h1>
							<p class="mb-3">Expand knowledge by reading books and courses. Find the perfect educational resources for your needs.</p>
							<div class="mt-3">
								<a href="{{ path('app_marketplace_index') }}" class="btn btn-primary btn-lg">
									<i class="bi bi-speedometer2 me-2"></i>Dashboard
								</a>
							</div>
						</div>

						<!-- Image -->
						<div class="col-md-6 text-center">
							<img src="{{ asset('images/book-bg.svg') }}" alt="" style="max-width: 100%; height: auto;">
						</div>
					</div> <!-- Row END -->
				</div>
			</div>
		</div> <!-- Row END -->
	</div>
</section>
<!-- =======================
Page Banner END -->

<!-- =======================
Navigation Tabs START -->
<section class="py-3 bg-white border-bottom">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<ul class="nav nav-pills nav-fill" id="marketplaceTabs" role="tablist">
					<li class="nav-item" role="presentation">
						<button class="nav-link active" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab">
							<i class="bi bi-briefcase me-2"></i>Services
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="job-requests-tab" data-bs-toggle="tab" data-bs-target="#job-requests" type="button" role="tab">
							<i class="bi bi-clipboard-data me-2"></i>Job Requests
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab">
							<i class="bi bi-cart3 me-2"></i>Orders
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="documentation-tab" data-bs-toggle="tab" data-bs-target="#documentation" type="button" role="tab">
							<i class="bi bi-book me-2"></i>Documentation
						</button>
					</li>
				</ul>
			</div>
		</div>
	</div>
</section>
<!-- =======================
Navigation Tabs END -->

<!-- =======================
Tab Content START -->
<section class="py-5">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="tab-content" id="marketplaceTabContent">

					<!-- Services Tab -->
					<div class="tab-pane fade show active" id="services" role="tabpanel">
						<div class="row mb-4 align-items-center">
							<div class="col-md-4">
								<h5 class="mb-0">All Services</h5>
							</div>
							<div class="col-md-8">
								<div class="row g-2">
									<div class="col-md-3">
										<input type="text" class="form-control" id="services-search" placeholder="Search services by title, description, category, or price...">
									</div>
									<div class="col-md-3">
										<select class="form-select" id="services-sort">
											<option value="default">Sort by</option>
											<option value="price-low">Price: Low to High</option>
											<option value="price-high">Price: High to Low</option>
											<option value="name-asc">Name: A to Z</option>
											<option value="name-desc">Name: Z to A</option>
										</select>
									</div>
									<div class="col-md-3">
										<!-- Currency Selector -->
										<div class="dropdown">
											<button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="shopCurrencyDropdown" data-bs-toggle="dropdown">
												<i class="fas fa-coins me-1"></i>
												<span id="shopCurrentCurrency">USD</span>
											</button>
											<ul class="dropdown-menu" id="shopCurrencyMenu">
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="USD">ðŸ‡ºðŸ‡¸ USD - US Dollar</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="EUR">ðŸ‡ªðŸ‡º EUR - Euro</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="GBP">ðŸ‡¬ðŸ‡§ GBP - British Pound</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="JPY">ðŸ‡¯ðŸ‡µ JPY - Japanese Yen</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="CAD">ðŸ‡¨ðŸ‡¦ CAD - Canadian Dollar</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="AUD">ðŸ‡¦ðŸ‡º AUD - Australian Dollar</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="CHF">ðŸ‡¨ðŸ‡­ CHF - Swiss Franc</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="CNY">ðŸ‡¨ðŸ‡³ CNY - Chinese Yuan</a></li>
												<li><a class="dropdown-item shop-currency-option" href="#" data-currency="INR">ðŸ‡®ðŸ‡³ INR - Indian Rupee</a></li>
											</ul>
										</div>
									</div>
									<div class="col-md-3 text-md-end">
										<a href="{{ path('app_product_new_public') }}" class="btn btn-success">
											<i class="bi bi-plus-circle me-1"></i>Create New
										</a>
									</div>
								</div>
							</div>
						</div>

						<div class="row g-4" id="services-container">
							{% for product in products %}
							<div class="col-sm-6 col-lg-4 col-xl-3 service-item" data-title="{{ product.title|lower }}" data-price="{{ product.price }}">
								<div class="card shadow h-100">
									<div class="position-relative">
										{% set productImage = product.image ? asset('uploads/products/' ~ product.image) : null %}
										{% if productImage %}
											<img src="{{ productImage }}" class="card-img-top" alt="service image" style="height: 150px; object-fit: cover;">
										{% else %}
											<div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 150px;">
												<i class="fas fa-image fa-2x text-muted opacity-25"></i>
											</div>
										{% endif %}
										<div class="card-img-overlay d-flex z-index-0 p-3">
											<div class="w-100 mb-auto d-flex justify-content-end">
												<div class="icon-md bg-dark rounded-circle fs-5">
													<a href="#" class="text-white"><i class="bi bi-briefcase"></i></a>
												</div>
											</div>
										</div>
									</div>
									<div class="card-body px-3">
										<div class="d-flex justify-content-between align-items-center mb-2">
											<span class="badge bg-purple bg-opacity-10 text-purple small">{{ product.category.name|default('General') }}</span>
											<span class="h6 fw-light mb-0 small"><i class="fas fa-star text-warning me-1"></i>4.5</span>
										</div>
										<h5 class="card-title mb-0">{{ product.title }}</h5>
									</div>
									<div class="card-footer pt-0 px-3">
										<div class="d-flex justify-content-between align-items-center mb-2">
											<span class="h6 fw-light mb-0">By {{ product.freelancer.email|default('Unknown') }}</span>
											<div class="text-end">
												<h5 class="text-success mb-0 shop-product-price" data-usd-price="{{ product.price }}">${{ product.price }}</h5>
												<div class="currency-prices small text-muted" id="shop-price-{{ product.id }}">
													<span class="eur-price">â‚¬{{ (product.price * 0.85)|number_format(2) }}</span>
													<span class="gbp-price">Â£{{ (product.price * 0.73)|number_format(2) }}</span>
												</div>
											</div>
										</div>
										<div class="d-flex gap-1">
											<a href="{{ path('app_product_show', {slug: product.slug }) }}" class="btn btn-sm btn-primary">
												<i class="bi bi-eye"></i> Read
											</a>
											<a href="{{ path('app_product_edit', {slug: product.slug }) }}" class="btn btn-sm btn-warning">
												<i class="bi bi-pencil"></i> Update
											</a>
											<form method="post" action="{{ path('app_product_delete', {slug: product.slug }) }}" style="display: inline;">
												<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.slug) }}">
												<button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this service?')">
													<i class="bi bi-trash"></i> Delete
												</button>
											</form>
											<button class="btn btn-sm btn-success" onclick="addToCart({{ product.id }})">
												<i class="bi bi-cart-plus"></i> Order
											</button>
											<a href="{{ path('app_cart') }}" class="btn btn-sm btn-outline-primary">
												<i class="bi bi-cart"></i> View Cart
											</a>
										</div>
									</div>
								</div>
							</div>
							{% else %}
							<div class="col-12">
								<div class="text-center py-5">
									<i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
									<h4>No Services Found</h4>
									<p class="text-muted">Be the first to offer a service!</p>
									<a href="{{ path('app_product_new') }}" class="btn btn-success">Create First Service</a>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>

					<!-- Job Requests Tab -->
					<div class="tab-pane fade" id="job-requests" role="tabpanel">
						<div class="row mb-4 align-items-center">
							<div class="col-md-4">
								<h5 class="mb-0">All Job Requests</h5>
							</div>
							<div class="col-md-8">
								<div class="row g-2">
									<div class="col-md-4">
										<input type="text" class="form-control" id="jobs-search" placeholder="Search jobs by title, description, category, status, or budget...">
									</div>
									<div class="col-md-4">
										<select class="form-select" id="jobs-sort">
											<option value="default">Sort by</option>
											<option value="price-low">Budget: Low to High</option>
											<option value="price-high">Budget: High to Low</option>
											<option value="name-asc">Title: A to Z</option>
											<option value="name-desc">Title: Z to A</option>
										</select>
									</div>
									<div class="col-md-4 text-md-end">
										<a href="{{ path('app_job_new_public') }}" class="btn btn-success">
											<i class="bi bi-plus-circle me-1"></i>Create New
										</a>
									</div>
								</div>
							</div>
						</div>

						<div class="row g-4" id="jobs-container">
							{% for job in jobs %}
							<div class="col-sm-6 col-lg-4 col-xl-3 job-item" data-title="{{ job.title|lower }}" data-budget="{{ job.budget ?? 0 }}">
								<div class="card shadow h-100">
									<div class="position-relative">
										<div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 150px;">
											<i class="fas fa-briefcase fa-2x text-muted"></i>
										</div>
										{% if job.status == 'open' %}
											<div class="position-absolute top-0 start-0 m-2">
												<span class="badge bg-success">ðŸ“‹ Open</span>
											</div>
										{% elseif job.status == 'assigned' %}
											<div class="position-absolute top-0 start-0 m-2">
												<span class="badge bg-warning">ðŸ”„ In Progress</span>
											</div>
										{% else %}
											<div class="position-absolute top-0 start-0 m-2">
												<span class="badge bg-secondary">âœ… Closed</span>
											</div>
										{% endif %}
									</div>
									<div class="card-body pb-0">
										<h5 class="card-title fw-normal">{{ job.title }}</h5>
										<p class="card-text text-truncate small">{{ job.description|slice(0, 100) }}...</p>
									</div>
									<div class="card-footer pt-0 px-3">
										<div class="d-flex justify-content-between align-items-center mb-2">
											<span class="h6 fw-light mb-0">{{ job.status|upper }}</span>
											<h5 class="text-success mb-0">${{ job.budget ?? 0 }}</h5>
										</div>
										<div class="d-flex gap-1">
											<a href="{{ path('app_job_show', {id: job.id}) }}" class="btn btn-sm btn-info">
												<i class="bi bi-eye"></i> Read
											</a>
											<button class="btn btn-sm btn-success" onclick="addToCart({{ job.id }})">
												<i class="bi bi-cart-plus"></i> Order
											</button>
											<a href="{{ path('app_cart') }}" class="btn btn-sm btn-outline-primary">
												<i class="bi bi-cart"></i> View Cart
											</a>
										</div>
									</div>
								</div>
							</div>
							{% else %}
							<div class="col-12 text-center py-5">
								<div class="alert alert-info">
									<i class="bi bi-info-circle me-2"></i>No job requests found. <a href="#" class="alert-link">Create the first one!</a>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>

					<!-- Orders Tab -->
					<div class="tab-pane fade" id="orders" role="tabpanel">
						<div class="text-center py-5">
							<div class="card shadow">
								<div class="card-body">
									<i class="bi bi-cart3 fa-3x text-muted mb-3"></i>
									<h4>Shopping Cart</h4>
									<p class="text-muted">View and manage your orders in the shopping cart.</p>
									<a href="{{ path('app_cart') }}" class="btn btn-success btn-lg">
										<i class="bi bi-cart3 me-2"></i>Go to Cart
									</a>
								</div>
							</div>
						</div>
					</div>

					<!-- Documentation Tab -->
					<div class="tab-pane fade" id="documentation" role="tabpanel">
						<div class="row mb-4 align-items-center">
							<div class="col-md-6">
								<h5 class="mb-0">Documentation & Help</h5>
							</div>
							<div class="col-md-6 text-md-end">
								<!-- CRUD buttons removed -->
							</div>
						</div>

						<div class="row g-4">
							<div class="col-md-6 col-lg-4">
								<div class="card shadow h-100">
									<div class="card-body text-center">
										<div class="icon-lg bg-primary bg-opacity-10 text-primary rounded-circle mx-auto mb-4">
											<i class="fas fa-book fa-2x"></i>
										</div>
										<h5 class="card-title">Getting Started Guide</h5>
										<p class="card-text text-muted">Complete guide on how to use the marketplace platform effectively.</p>
										<button class="btn btn-outline-primary">Read More</button>
									</div>
								</div>
							</div>

							<div class="col-md-6 col-lg-4">
								<div class="card shadow h-100">
									<div class="card-body text-center">
										<div class="icon-lg bg-success bg-opacity-10 text-success rounded-circle mx-auto mb-4">
											<i class="fas fa-question-circle fa-2x"></i>
										</div>
										<h5 class="card-title">FAQ</h5>
										<p class="card-text text-muted">Frequently asked questions about services, jobs, and orders.</p>
										<button class="btn btn-outline-success">Read More</button>
									</div>
								</div>
							</div>

							<div class="col-md-6 col-lg-4">
								<div class="card shadow h-100">
									<div class="card-body text-center">
										<div class="icon-lg bg-warning bg-opacity-10 text-warning rounded-circle mx-auto mb-4">
											<i class="fas fa-headset fa-2x"></i>
										</div>
										<h5 class="card-title">Support</h5>
										<p class="card-text text-muted">Get help from our support team for any issues or questions.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
<!-- =======================
Tab Content END -->

{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Services Search and Sort
    const servicesSearch = document.getElementById('services-search');
    const servicesSort = document.getElementById('services-sort');
    const servicesContainer = document.getElementById('services-container');

    function filterAndSortServices() {
        const searchTerm = servicesSearch.value.toLowerCase();
        const sortValue = servicesSort.value;
        const items = Array.from(servicesContainer.querySelectorAll('.service-item'));

        // Filter - search through title, description, and category
        items.forEach(item => {
            const title = item.dataset.title.toLowerCase();
            const description = item.querySelector('.card-text')?.textContent.toLowerCase() || '';
            const category = item.querySelector('.text-muted')?.textContent.toLowerCase() || '';
            const price = item.querySelector('.text-success')?.textContent.toLowerCase() || '';
            
            const searchableContent = title + ' ' + description + ' ' + category + ' ' + price;
            const shouldShow = searchableContent.includes(searchTerm);
            item.style.display = shouldShow ? '' : 'none';
        });

        // Sort
        const visibleItems = items.filter(item => item.style.display !== 'none');
        
        if (sortValue === 'price-low') {
            visibleItems.sort((a, b) => parseFloat(a.dataset.price) - parseFloat(b.dataset.price));
        } else if (sortValue === 'price-high') {
            visibleItems.sort((a, b) => parseFloat(b.dataset.price) - parseFloat(a.dataset.price));
        } else if (sortValue === 'name-asc') {
            visibleItems.sort((a, b) => a.dataset.title.localeCompare(b.dataset.title));
        } else if (sortValue === 'name-desc') {
            visibleItems.sort((a, b) => b.dataset.title.localeCompare(a.dataset.title));
        }

        // Re-append sorted items
        visibleItems.forEach(item => servicesContainer.appendChild(item));
    }

    servicesSearch.addEventListener('input', filterAndSortServices);
    servicesSort.addEventListener('change', filterAndSortServices);

    // Jobs Search and Sort
    const jobsSearch = document.getElementById('jobs-search');
    const jobsSort = document.getElementById('jobs-sort');
    const jobsContainer = document.getElementById('jobs-container');

    function filterAndSortJobs() {
        const searchTerm = jobsSearch.value.toLowerCase();
        const sortValue = jobsSort.value;
        const items = Array.from(jobsContainer.querySelectorAll('.job-item'));

        // Filter - search through title, description, category, and status
        items.forEach(item => {
            const title = item.dataset.title.toLowerCase();
            const description = item.querySelector('.card-text')?.textContent.toLowerCase() || '';
            const category = item.querySelector('.text-muted')?.textContent.toLowerCase() || '';
            const status = item.querySelector('.badge')?.textContent.toLowerCase() || '';
            const price = item.querySelector('.text-success')?.textContent.toLowerCase() || '';
            
            const searchableContent = title + ' ' + description + ' ' + category + ' ' + status + ' ' + price;
            const shouldShow = searchableContent.includes(searchTerm);
            item.style.display = shouldShow ? '' : 'none';
        });

        // Sort
        const visibleItems = items.filter(item => item.style.display !== 'none');
        
        if (sortValue === 'price-low') {
            visibleItems.sort((a, b) => parseFloat(a.dataset.budget) - parseFloat(b.dataset.budget));
        } else if (sortValue === 'price-high') {
            visibleItems.sort((a, b) => parseFloat(b.dataset.budget) - parseFloat(a.dataset.budget));
        } else if (sortValue === 'name-asc') {
            visibleItems.sort((a, b) => a.dataset.title.localeCompare(b.dataset.title));
        } else if (sortValue === 'name-desc') {
            visibleItems.sort((a, b) => b.dataset.title.localeCompare(a.dataset.title));
        }

        // Re-append sorted items
        visibleItems.forEach(item => jobsContainer.appendChild(item));
    }

    jobsSearch.addEventListener('input', filterAndSortJobs);
    jobsSort.addEventListener('change', filterAndSortJobs);
});

// Cart Management Functions
function addToCart(productId) {
    fetch(`/cart/add/${productId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success notification
                showNotification('Product added to cart!', 'success');
                updateCartCount();
                
                // Update button state
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="bi bi-check"></i> Added!';
                button.classList.remove('btn-success');
                button.classList.add('btn-primary');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-success');
                }, 2000);
                
                // Optional: Redirect to cart after a short delay
                setTimeout(() => {
                    if (confirm('Product added to cart! Would you like to view your cart?')) {
                        window.location.href = '/cart';
                    }
                }, 2500);
            }
        })
        .catch(error => {
            console.error('Error adding to cart:', error);
            showNotification('Failed to add product to cart', 'error');
        });
}

function updateCartCount() {
    fetch('/cart/count')
        .then(response => response.json())
        .then(data => {
            // Update cart count in navigation if cart badge exists
            const cartBadges = document.querySelectorAll('.cart-count');
            cartBadges.forEach(badge => {
                badge.textContent = data.count;
                badge.style.display = data.count > 0 ? 'inline' : 'none';
            });
        });
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} position-fixed top-0 end-0 m-3`;
    notification.style.zIndex = '9999';
    notification.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
            ${message}
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Update cart count on page load
document.addEventListener('DOMContentLoaded', function() {
    updateCartCount();
    initShopCurrencyConverter();
});

// Shop Currency Converter Functions
let shopCurrentCurrency = localStorage.getItem('selectedCurrency') || 'USD';
const shopExchangeRates = {
    'USD': 1,
    'EUR': 0.85,
    'GBP': 0.73,
    'JPY': 110.0,
    'CAD': 1.25,
    'AUD': 1.35,
    'CHF': 0.92,
    'CNY': 6.45,
    'INR': 74.0
};

const shopCurrencySymbols = {
    'USD': '$',
    'EUR': 'â‚¬',
    'GBP': 'Â£',
    'JPY': 'Â¥',
    'CAD': 'C$',
    'AUD': 'A$',
    'CHF': 'CHF',
    'CNY': 'Â¥',
    'INR': 'â‚¹'
};

function initShopCurrencyConverter() {
    // Set current currency display
    const shopCurrencyElement = document.getElementById('shopCurrentCurrency');
    if (shopCurrencyElement) {
        shopCurrencyElement.textContent = shopCurrentCurrency;
    }
    
    // Add event listeners to currency options
    document.querySelectorAll('.shop-currency-option').forEach(option => {
        option.addEventListener('click', function(e) {
            e.preventDefault();
            const newCurrency = this.dataset.currency;
            changeShopCurrency(newCurrency);
        });
    });
    
    // Update all prices on page load
    updateShopAllPrices();
}

function changeShopCurrency(currency) {
    shopCurrentCurrency = currency;
    localStorage.setItem('selectedCurrency', currency);
    const shopCurrencyElement = document.getElementById('shopCurrentCurrency');
    if (shopCurrencyElement) {
        shopCurrencyElement.textContent = currency;
    }
    updateShopAllPrices();
    showNotification(`Currency changed to ${currency}`, 'success');
}

function convertShopPrice(usdPrice, toCurrency) {
    if (toCurrency === 'USD') return usdPrice;
    return usdPrice * (shopExchangeRates[toCurrency] || 1);
}

function formatShopPrice(price, currency) {
    const symbol = shopCurrencySymbols[currency] || currency;
    
    switch (currency) {
        case 'EUR':
            return symbol + price.toFixed(2).replace('.', ',');
        case 'JPY':
        case 'CNY':
            return symbol + Math.round(price);
        case 'INR':
            return symbol + price.toFixed(2).replace('.', ',');
        default:
            return symbol + price.toFixed(2);
    }
}

function updateShopAllPrices() {
    // Update shop product prices
    document.querySelectorAll('.shop-product-price').forEach(priceElement => {
        const usdPrice = parseFloat(priceElement.dataset.usdPrice);
        if (!usdPrice) return;
        
        const convertedPrice = convertShopPrice(usdPrice, shopCurrentCurrency);
        const formattedPrice = formatShopPrice(convertedPrice, shopCurrentCurrency);
        
        // Update main price
        priceElement.textContent = formattedPrice;
    });
    
    // Update currency prices display
    document.querySelectorAll('.currency-prices').forEach(currencyPrices => {
        const productId = currencyPrices.id.replace('shop-price-', '');
        const priceElement = document.querySelector(`#shop-price-${productId}`);
        if (priceElement) {
            const usdPrice = parseFloat(priceElement.dataset.usdPrice);
            if (!usdPrice) return;
            
            if (shopCurrentCurrency === 'USD') {
                currencyPrices.innerHTML = `
                    <span class="eur-price">${formatShopPrice(convertShopPrice(usdPrice, 'EUR'), 'EUR')}</span>
                    <span class="gbp-price">${formatShopPrice(convertShopPrice(usdPrice, 'GBP'), 'GBP')}</span>
                `;
            } else {
                currencyPrices.innerHTML = `
                    <span class="usd-price">${formatShopPrice(usdPrice, 'USD')}</span>
                `;
            }
        }
    });
}

// Fetch real exchange rates for shop
async function fetchShopExchangeRates() {
    try {
        const response = await fetch('https://api.exchangerate.host/latest?access_key=ce959b41ed1e15ff5f57064926e5d1d1');
        const data = await response.json();
        
        if (data.rates) {
            Object.assign(shopExchangeRates, data.rates);
            shopExchangeRates.USD = 1; // Ensure USD is 1
            updateShopAllPrices();
        }
    } catch (error) {
        console.log('Using fallback exchange rates for shop');
        console.log('API Error:', error);
    }
}

// Fetch exchange rates on page load
fetchShopExchangeRates();
</script>

<style>
.card {
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
}

.nav-pills .nav-link {
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

/* Shop Currency Styles */
.currency-prices {
    display: flex;
    gap: 8px;
    font-size: 0.75rem;
    opacity: 0.8;
}

.currency-prices span {
    padding: 2px 4px;
    border-radius: 3px;
    background-color: rgba(0,0,0,0.05);
}

.shop-product-price {
    transition: all 0.3s ease;
}

.shop-product-price:hover {
    transform: scale(1.05);
}

.shop-currency-option {
    display: flex;
    align-items: center;
    gap: 8px;
}

.shop-currency-option:hover {
    background-color: #f8f9fa;
}

#shopCurrencyDropdown {
    display: flex;
    align-items: center;
    gap: 4px;
}

.cart-count {
    background-color: #dc3545;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 0.75rem;
    margin-left: 5px;
}

.position-fixed {
    position: fixed;
}

.service-item, .job-item, .order-item {
    transition: all 0.3s ease;
}

.service-item:hover, .job-item:hover, .order-item:hover {
    transform: translateY(-3px);
}

.d-flex.gap-1 {
    gap: 0.25rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .currency-prices {
        flex-direction: column;
        gap: 2px;
    }
    
    .currency-prices span {
        font-size: 0.65rem;
    }
}
</style>
{% endblock %}
